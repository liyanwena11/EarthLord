# ğŸš€ æ•°æ®åº“ä¿®å¤åˆ†æ­¥æŒ‡å—

**å¦‚æœ Supabase æ§åˆ¶å°æ— æ³•è®¿é—®ï¼Œè¯·å°è¯•ä»¥ä¸‹æ–¹æ³•ï¼š**

---

## æ–¹æ³• 1: åˆ·æ–°é¡µé¢é‡è¯•

1. **æ¸…é™¤æµè§ˆå™¨ç¼“å­˜**
   - æŒ‰ `Cmd + Shift + Delete` (Mac)
   - æ¸…é™¤ç¼“å­˜å’Œ Cookie
   - åˆ·æ–°é¡µé¢

2. **ä½¿ç”¨æ— ç—•æ¨¡å¼**
   - Chrome/Edge: `Cmd + Shift + N`
   - Firefox: `Cmd + Shift + P`
   - Safari: `Cmd + Shift + N`

3. **é‡æ–°è®¿é—®**
   - è®¿é—® https://supabase.com/dashboard
   - é€‰æ‹©é¡¹ç›®ï¼š`EarthLord (lkekxzssfrspkyxtqysx)`

---

## æ–¹æ³• 2: é€ä¸ªå¤åˆ¶ SQL è¯­å¥æ‰§è¡Œ

**æ‰“å¼€ Supabase SQL Editorï¼Œé€ä¸ªæ‰§è¡Œä»¥ä¸‹è¯­å¥ï¼š**

### âœ… æ­¥éª¤ 1: ä¿®å¤ communication_channels è¡¨

```sql
ALTER TABLE public.communication_channels ADD COLUMN IF NOT EXISTS updated_at TIMESTAMPTZ DEFAULT NOW();
```

**ç‚¹å‡» "Run"**ï¼Œç­‰å¾…æ‰§è¡Œå®Œæˆã€‚

---

### âœ… æ­¥éª¤ 2: ä¿®å¤ channel_subscriptions è¡¨

```sql
ALTER TABLE public.channel_subscriptions ADD COLUMN IF NOT EXISTS is_muted BOOLEAN DEFAULT false;
```

**ç‚¹å‡» "Run"**ï¼Œç­‰å¾…æ‰§è¡Œå®Œæˆã€‚

---

### âœ… æ­¥éª¤ 3: ä¿®å¤ channel_messages è¡¨ï¼ˆç¬¬ 1 ä¸ªå­—æ®µï¼‰

```sql
ALTER TABLE public.channel_messages ADD COLUMN IF NOT EXISTS sender_callsign TEXT;
```

**ç‚¹å‡» "Run"**ï¼Œç­‰å¾…æ‰§è¡Œå®Œæˆã€‚

---

### âœ… æ­¥éª¤ 4: ä¿®å¤ channel_messages è¡¨ï¼ˆç¬¬ 2 ä¸ªå­—æ®µï¼‰

```sql
ALTER TABLE public.channel_messages ADD COLUMN IF NOT EXISTS metadata JSONB;
```

**ç‚¹å‡» "Run"**ï¼Œç­‰å¾…æ‰§è¡Œå®Œæˆã€‚

---

### âœ… æ­¥éª¤ 5: éªŒè¯ä¿®å¤æ˜¯å¦æˆåŠŸ

```sql
SELECT
    'communication_channels.updated_at' as field_name,
    CASE WHEN EXISTS (
        SELECT 1 FROM information_schema.columns
        WHERE table_schema = 'public'
        AND table_name = 'communication_channels'
        AND column_name = 'updated_at'
    ) THEN 'âœ… å·²æ·»åŠ ' ELSE 'âŒ ç¼ºå¤±' END as status

UNION ALL

SELECT
    'channel_subscriptions.is_muted',
    CASE WHEN EXISTS (
        SELECT 1 FROM information_schema.columns
        WHERE table_schema = 'public'
        AND table_name = 'channel_subscriptions'
        AND column_name = 'is_muted'
    ) THEN 'âœ… å·²æ·»åŠ ' ELSE 'âŒ ç¼ºå¤±' END

UNION ALL

SELECT
    'channel_messages.sender_callsign',
    CASE WHEN EXISTS (
        SELECT 1 FROM information_schema.columns
        WHERE table_schema = 'public'
        AND table_name = 'channel_messages'
        AND column_name = 'sender_callsign'
    ) THEN 'âœ… å·²æ·»åŠ ' ELSE 'âŒ ç¼ºå¤±' END

UNION ALL

SELECT
    'channel_messages.metadata',
    CASE WHEN EXISTS (
        SELECT 1 FROM information_schema.columns
        WHERE table_schema = 'public'
        AND table_name = 'channel_messages'
        AND column_name = 'metadata'
    ) THEN 'âœ… å·²æ·»åŠ ' ELSE 'âŒ ç¼ºå¤±' END;
```

**ç‚¹å‡» "Run"**ï¼ŒæŸ¥çœ‹ç»“æœã€‚**æ‰€æœ‰å­—æ®µéƒ½åº”è¯¥æ˜¾ç¤º "âœ… å·²æ·»åŠ "**ã€‚

---

## æ–¹æ³• 3: ä½¿ç”¨ Supabase APIï¼ˆé«˜çº§ï¼‰

å¦‚æœ SQL Editor å®Œå…¨æ— æ³•è®¿é—®ï¼Œä½¿ç”¨ APIï¼š

```bash
# 1. è·å– Access Tokenï¼ˆä»æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼‰
#    - æ‰“å¼€ Supabase Dashboard
#    - æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
#    - è¿›å…¥ Application/Storage â†’ Local Storage
#    - å¤åˆ¶ sb-access-token çš„å€¼

# 2. è®¾ç½®ç¯å¢ƒå˜é‡
export SUPABASE_URL="https://lkekxzssfrspkyxtqysx.supabase.co"
export SUPABASE_KEY="ä½ çš„æœåŠ¡ç«¯å¯†é’¥"

# 3. æ‰§è¡Œ ALTER TABLE è¯­å¥
curl -X POST "$SUPABASE_URL/rest/v1/rpc/execute_sql" \
  -H "apikey: $SUPABASE_KEY" \
  -H "Authorization: Bearer $SUPABASE_KEY" \
  -H "Content-Type: application/json" \
  -d '{"sql": "ALTER TABLE public.communication_channels ADD COLUMN IF NOT EXISTS updated_at TIMESTAMPTZ DEFAULT NOW();"}'
```

---

## ğŸ§ª éªŒè¯ä¿®å¤æ˜¯å¦æˆåŠŸ

æ‰§è¡Œå®Œæ‰€æœ‰æ­¥éª¤åï¼Œé‡å¯ App å¹¶æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼š

### âœ… æˆåŠŸçš„æ—¥å¿—ç¤ºä¾‹ï¼š

```
ğŸ”„ [é¢‘é“ä¸­å¿ƒ] å¼€å§‹åŠ è½½é¢‘é“æ•°æ®...
ğŸ“¡ [é¢‘é“ä¸­å¿ƒ] ç”¨æˆ·ID: E04D8649-18D2-46D3-ADE7-ABB8CC73C0F6
âœ… [é¢‘é“] åŠ è½½å…¬å¼€é¢‘é“: 3 ä¸ª
âœ… [é¢‘é“] åŠ è½½å·²è®¢é˜…é¢‘é“: 1 ä¸ª
ğŸ“Š [é¢‘é“ä¸­å¿ƒ] æ•°æ®åŠ è½½å®Œæˆ:
  - å…¬å¼€é¢‘é“: 3 ä¸ª
  - å·²è®¢é˜…é¢‘é“: 1 ä¸ª
```

### âŒ å¤±è´¥çš„æ—¥å¿—ç¤ºä¾‹ï¼ˆä»ç„¶æœ‰é—®é¢˜ï¼‰ï¼š

```
âŒ [é¢‘é“] åŠ è½½å…¬å¼€é¢‘é“å¤±è´¥: æœªèƒ½è¯»å–æ•°æ®ï¼Œå› ä¸ºæ•°æ®ç¼ºå¤±ã€‚
âŒ [é¢‘é“] åŠ è½½å·²è®¢é˜…é¢‘é“å¤±è´¥: æœªèƒ½è¯»å–æ•°æ®ï¼Œå› ä¸ºæ•°æ®ç¼ºå¤±ã€‚
```

---

## ğŸ“ å¦‚æœä»ç„¶å¤±è´¥

**è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯**ï¼š

1. éªŒè¯æŸ¥è¯¢çš„è¾“å‡ºç»“æœï¼ˆæ­¥éª¤ 5ï¼‰
2. App çš„å®Œæ•´æ§åˆ¶å°æ—¥å¿—
3. Supabase SQL Editor çš„é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰

---

**å¿«é€Ÿå‚è€ƒ - æ‰€æœ‰ SQL è¯­å¥ï¼š**

```sql
-- 1. æ·»åŠ  updated_at å­—æ®µ
ALTER TABLE public.communication_channels ADD COLUMN IF NOT EXISTS updated_at TIMESTAMPTZ DEFAULT NOW();

-- 2. æ·»åŠ  is_muted å­—æ®µ
ALTER TABLE public.channel_subscriptions ADD COLUMN IF NOT EXISTS is_muted BOOLEAN DEFAULT false;

-- 3. æ·»åŠ  sender_callsign å­—æ®µ
ALTER TABLE public.channel_messages ADD COLUMN IF NOT EXISTS sender_callsign TEXT;

-- 4. æ·»åŠ  metadata å­—æ®µ
ALTER TABLE public.channel_messages ADD COLUMN IF NOT EXISTS metadata JSONB;

-- 5. éªŒè¯
SELECT table_name, column_name, data_type
FROM information_schema.columns
WHERE table_schema = 'public'
AND table_name IN ('communication_channels', 'channel_subscriptions', 'channel_messages')
AND column_name IN ('updated_at', 'is_muted', 'sender_callsign', 'metadata')
ORDER BY table_name, column_name;
```

---

**åˆ›å»ºæ—¶é—´**: 2026-02-22
**çŠ¶æ€**: âœ… å¯ä»¥ç«‹å³æ‰§è¡Œ
