# ğŸ” EarthLord è®¢é˜…ç³»ç»Ÿå¿«é€Ÿå‚è€ƒæŒ‡å—

**æ—¶é—´**: éœ€è¦å¸®åŠ©æ—¶å¿«é€ŸæŸ¥é˜…  
**å†…å®¹**: å…³é”®ä»£ç ç‰‡æ®µ + å¸¸è§é—®é¢˜ + è°ƒè¯•æŠ€å·§

---

## ğŸ¯ å¿«é€Ÿå¯¼èˆª

### å¸¸è§ä»»åŠ¡é€ŸæŸ¥

| ä»»åŠ¡ | æ–‡ä»¶ | è€—æ—¶ |
|------|------|------|
| åˆ›å»ºäº§å“ ID | App Store Connect | 10åˆ†é’Ÿ |
| æŸ¥è¯¢ç”¨æˆ·è®¢é˜…çŠ¶æ€ | IAPManager | 30ç§’ |
| è´­ä¹°è®¢é˜… | IAPManager | 1è¡Œä»£ç  |
| åº”ç”¨æƒç›Š (èƒŒåŒ…) | InventoryManager | 1è¡Œä»£ç  |
| æ£€æŸ¥æƒé™é™åˆ¶ | ExplorationManager | 1è¡Œä»£ç  |
| ä¿®å¤"å‰©ä½™0å¤©" | DBUserSubscription | 5åˆ†é’Ÿ |
| æ²™ç›’æµ‹è¯• | App Store | 30åˆ†é’Ÿ |

---

## ğŸ’¾ å…³é”®ä»£ç ç‰‡æ®µåº“

### ç‰‡æ®µ 1ï¸âƒ£: è·å–ç”¨æˆ·è®¢é˜…ç­‰çº§

```swift
// æœ€ç®€å•çš„æ–¹å¼ - 1 è¡Œä»£ç 
let tier = IAPManager.shared.subscriptionTier  // .free, .explorer, .lord

// æ ¹æ®è®¢é˜…ç­‰çº§åšåˆ¤æ–­
switch IAPManager.shared.subscriptionTier {
case .free:
    explorationLimit = 10
case .explorer:
    explorationLimit = Int.max
case .lord:
    explorationLimit = Int.max
}
```

### ç‰‡æ®µ 2ï¸âƒ£: æ£€æŸ¥æƒç›Šæ˜¯å¦æ»¡è¶³

```swift
// èƒŒåŒ…æ˜¯å¦æœ‰ç©ºé—´
if inventoryManager.isInventoryFull(itemCount: currentItems) {
    showAlert("èƒŒåŒ…å·²æ»¡ï¼Œå‡çº§é€šè¡Œè¯è·å¾—æ›´å¤§å®¹é‡")
}

// æ¢ç´¢æ¬¡æ•°æ˜¯å¦è¶…é™
if !explorationManager.canExplore() {
    showAlert("ä»Šæ—¥æ¢ç´¢æ¬¡æ•°å·²ç”¨å®Œ")
}
```

### ç‰‡æ®µ 3ï¸âƒ£: è§¦å‘è´­ä¹°æµç¨‹

```swift
Button("å‡çº§åˆ°æ¢ç´¢è€…") {
    Task {
        let product = iapManager.subscriptionProducts.first { 
            $0.tier == .explorer && $0.period == .monthly 
        }
        if let product = product {
            let success = await iapManager.purchaseSubscription(product)
            if success { print("âœ… è´­ä¹°æˆåŠŸ") }
        }
    }
}
```

### ç‰‡æ®µ 4ï¸âƒ£: æ˜¾ç¤ºç²¾å‡†å‰©ä½™æ—¶é—´

```swift
// ä¿®å¤"å‰©ä½™0å¤©"é—®é¢˜
Text(
    iapManager.activeSubscription?.formattedRemainingTime 
    ?? "å·²è¿‡æœŸ"
)
.foregroundColor(.red)

// è¾“å‡ºç¤ºä¾‹:
// - å‰©ä½™ 45 ç§’
// - å‰©ä½™ 3 åˆ†é’Ÿ
// - å‰©ä½™ 2 å°æ—¶
// - å‰©ä½™ 15 å¤©
```

### ç‰‡æ®µ 5ï¸âƒ£: æ¢å¤è´­ä¹°

```swift
Button("æ¢å¤è´­ä¹°") {
    Task {
        await iapManager.restoreSubscriptions()
        await iapManager.loadActiveSubscription()
    }
}
```

---

## ğŸ› å¸¸è§é—®é¢˜é€ŸæŸ¥è¡¨

### Q1: æ˜¾ç¤º"å‰©ä½™ 0 å¤©"

**å¿«é€Ÿä¿®å¤**:
```swift
// DBUserSubscription ä¸­ä¿®æ”¹
var remainingDays: Int? {
    guard expiresAt > Date() else { return 0 }
    let remainingSeconds = expiresAt.timeIntervalSince(Date())
    return max(1, Int(ceil(remainingSeconds / 86400)))  // â† å‘ä¸Šå–æ•´
}

var formattedRemainingTime: String {
    let remaining = expiresAt.timeIntervalSince(Date())
    if remaining < 60 { return "å‰©ä½™ \(Int(remaining)) ç§’" }
    if remaining < 3600 { return "å‰©ä½™ \(Int(remaining / 60)) åˆ†é’Ÿ" }
    if remaining < 86400 { return "å‰©ä½™ \(Int(remaining / 3600)) å°æ—¶" }
    return "å‰©ä½™ \(Int(ceil(remaining / 86400))) å¤©"
}
```

**åŸå› **: æ²™ç›’ç¯å¢ƒæœˆè®¢é˜…åªæœ‰ 5 åˆ†é’Ÿæœ‰æ•ˆæœŸã€‚

---

### Q2: æƒç›Šä¸ç”Ÿæ•ˆ

**ç—‡çŠ¶**: è´­ä¹°åèƒŒåŒ…ä»æ˜¯ 100 æ ¼

**å¿«é€Ÿæ’æŸ¥**:
```swift
// æ£€æŸ¥ç­‰çº§
print("è®¢é˜…ç­‰çº§: \(IAPManager.shared.subscriptionTier)")

// æ£€æŸ¥èƒŒåŒ…
print("èƒŒåŒ…å®¹é‡: \(inventoryManager.maxCapacity)")

// é‡æ–°åˆ·æ–°
await inventoryManager.loadPlayerInventory()
```

---

### Q3: æ²™ç›’æ— æ³•è´­ä¹°

**æ£€æŸ¥æ¸…å•**:
- [ ] äº§å“ ID ä¸ App Store Connect å®Œå…¨ä¸€è‡´
- [ ] æ²™ç›’è´¦å·å·²ç™»å½• (Settings > App Store)
- [ ] æ¸…ç©º Xcode ç¼“å­˜: `rm -rf ~/Library/Developer/Xcode/DerivedData/*`
- [ ] ç½‘ç»œè¿æ¥æ­£å¸¸

---

### Q4: æ¢å¤è´­ä¹°ä¸å·¥ä½œ

**åŸå› **: é€šå¸¸æ˜¯å› ä¸ºåœ¨ä¸åŒè´¦å·ä¹‹é—´åˆ‡æ¢

**ä¿®å¤**:
```swift
// ç¡®è®¤ç™»å½•åŒä¸€æ²™ç›’è´¦å·
Settings > App Store > æ£€æŸ¥é‚®ç®±

// ç„¶åæ¢å¤
await iapManager.restoreSubscriptions()
```

---

## ğŸ“Š å¿«é€Ÿå‚è€ƒè¡¨

### è®¢é˜…äº§å“

| äº§å“ | ID | ä»·æ ¼ | å‘¨æœŸ |
|------|-----|------|------|
| å…è´¹ | - | Â¥0 | - |
| æ¢ç´¢è€…-æœˆ | `com.earthlord.sub.explorer.monthly` | Â¥12 | 1æœˆ |
| æ¢ç´¢è€…-å¹´ | `com.earthlord.sub.explorer.yearly` | Â¥88 | 1å¹´ |
| é¢†ä¸»-æœˆ | `com.earthlord.sub.lord.monthly` | Â¥25 | 1æœˆ |
| é¢†ä¸»-å¹´ | `com.earthlord.sub.lord.yearly` | Â¥168 | 1å¹´ |

### æƒç›Šå¯¹æ¯”

| æƒç›Š | å…è´¹ | æ¢ç´¢è€… | é¢†ä¸» |
|------|------|--------|------|
| èƒŒåŒ… | 100 | 200 | 300 |
| å»ºé€  | 1x | 2x | 2x |
| æ¢ç´¢ | 10x/å¤© | âˆ | âˆ |
| äº¤æ˜“ | 10x/å¤© | âˆ | âˆ |

### æ²™ç›’æ—¶é—´

| å®é™… | æ²™ç›’ |
|------|------|
| 1 æœˆ | 5 åˆ†é’Ÿ |
| 1 å¹´ | 1 å°æ—¶ |

---

## ğŸ†˜ ç´§æ€¥æ•‘åŠ©

### åº”ç”¨å´©æºƒ

```swift
// âŒ å±é™©çš„åšæ³•
let tier = IAPManager.shared.subscriptionTier!  // Force unwrap

// âœ… å®‰å…¨çš„åšæ³•
let tier = IAPManager.shared.subscriptionTier ?? .free
```

### ç¼–è¯‘å¤±è´¥

```bash
# æ¸…ç©ºç¼“å­˜
rm -rf ~/Library/Developer/Xcode/DerivedData/*

# é‡æ–°ç¼–è¯‘
xcodebuild clean -scheme EarthLord
```

---

**ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025å¹´2æœˆ
