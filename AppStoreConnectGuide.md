# App Store Connect 配置指南
## EarthLord 末日通行证系统

本文档提供了在 App Store Connect 中配置订阅产品和消耗品的完整步骤。

---

## 📋 配置概览

| 类型 | 数量 | 用途 |
|------|------|------|
| 订阅组 | 3 | 探索者、领主、末日通行证 |
| 订阅产品 | 9 | 每组3个（月付、年付、试用） |
| 消耗品 | 4 | 4个补给包 |

---

## 🔑 前置准备

1. **登录 App Store Connect**
   - 访问: https://appstoreconnect.apple.com
   - 使用开发者账号登录

2. **选择 App**
   - 进入"我的 App"
   - 选择 EarthLord 项目

3. **进入功能菜单**
   - 左侧菜单选择"功能"
   - 选择"App 内购买项目"或"订阅"

---

## 📱 第一阶段：配置订阅产品

### 步骤 1：创建订阅组

每个订阅需要一个独立的订阅组，共创建 **3个订阅组**：

#### 1.1 探索者通行证订阅组

**订阅组信息：**
- **订阅组 ID**: `com.earthlord.subscription.explorer`
- **名称**: 探索者通行证
- **本地化名称**: 探索者通行证

**创建步骤：**
1. 点击"订阅组"旁边的"+"按钮
2. 输入订阅组 ID: `com.earthlord.subscription.explorer`
3. 输入显示名称: "探索者通行证"
4. 添加本地化（中文简体）
5. 点击"创建"

#### 1.2 领主通行证订阅组

**订阅组信息：**
- **订阅组 ID**: `com.earthlord.subscription.lord`
- **名称**: 领主通行证
- **本地化名称**: 领主通行证

#### 1.3 末日通行证订阅组

**订阅组 ID**: `com.earthlord.subscription.apocalypse`
- **名称**: 末日通行证
- **本地化名称**: 末日通行证

---

### 步骤 2：创建订阅产品

每个订阅组需要创建 **3个产品**，共 **9个产品**。

#### 2.1 探索者通行证产品

在"探索者通行证"订阅组下创建：

| 产品 ID | 类型 | 价格 | 描述 |
|---------|------|------|------|
| `com.earthlord.sub.explorer.monthly` | 月付订阅 | ¥12/月 ($1.99) | 探索者通行证 - 月付 |
| `com.earthlord.sub.explorer.yearly` | 年付订阅 | ¥88/年 ($11.99) | 探索者通行证 - 年付，省39% |
| `com.earthlord.sub.explorer.trial` | 7天试用 | 免费 | 探索者通行证 - 7天免费试用 |

**创建步骤：**
1. 点击订阅组旁的"+"按钮
2. 选择"自动续期订阅"
3. 输入产品 ID（必须与代码中完全一致）
4. 选择价格等级
5. 配置本地化信息

**本地化信息（中文简体）：**
- **名称**: 探索者通行证（月付/年付）
- **描述**: 适合新手玩家，快速起步。包含建造加速+10%、生产加速+10%、背包容量+5kg等权益。

#### 2.2 领主通行证产品

在"领主通行证"订阅组下创建：

| 产品 ID | 类型 | 价格 | 描述 |
|---------|------|------|------|
| `com.earthlord.sub.lord.monthly` | 月付订阅 | ¥25/月 ($3.99) | 领主通行证 - 月付 |
| `com.earthlord.sub.lord.yearly` | 年付订阅 | ¥168/年 ($23.99) | 领主通行证 - 年付，省44% |
| `com.earthlord.sub.lord.trial` | 7天试用 | 免费 | 领主通行证 - 7天免费试用 |

**本地化信息（中文简体）：**
- **名称**: 领主通行证（月付/年付）
- **描述**: 中级玩家首选，全面加成。包含建造加速+25%、生产加速+25%、背包容量+10kg、VIP名牌等权益。

#### 2.3 末日通行证产品

在"末日通行证"订阅组下创建：

| 产品 ID | 类型 | 价格 | 描述 |
|---------|------|------|------|
| `com.earthlord.sub.apocalypse.monthly` | 月付订阅 | ¥50/月 ($7.99) | 末日通行证 - 月付 |
| `com.earthlord.sub.apocalypse.yearly` | 年付订阅 | ¥328/年 ($47.99) | 末日通行证 - 年付，省45% |
| `com.earthlord.sub.apocalypse.trial` | 7天试用 | 免费 | 末日通行证 - 7天免费试用 |

**本地化信息（中文简体）：**
- **名称**: 末日通行证（月付/年付）
- **描述**: 高级玩家专享，最强权益。包含建造加速+50%、生产加速+50%、背包容量+20kg、无限队列等全部权益。

---

## 📦 第二阶段：配置消耗品

### 步骤 3：创建补给包消耗品

共创建 **4个消耗品**：

| 产品 ID | 类型 | 价格 | 名称 |
|---------|------|------|------|
| `com.earthlord.supply.survivor` | 消耗品 | ¥6 ($0.99) | 幸存者补给包 |
| `com.earthlord.supply.explorer` | 消耗品 | ¥18 ($2.99) | 探险家补给包 |
| `com.earthlord.supply.lord` | 消耗品 | ¥30 ($4.99) | 领主补给包 |
| `com.earthlord.supply.overlord` | 消耗品 | ¥68 ($9.99) | 霸主补给包 |

**创建步骤：**
1. 在"App 内购买项目"页面点击"+"
2. 选择"消耗型"
3. 输入产品 ID
4. 选择价格等级
5. 配置本地化信息

**本地化信息示例（幸存者补给包）：**
- **名称**: 幸存者补给包
- **描述**: 新手必备补给包，包含饮用水、罐头食品、木材、石头等基础生存物资。

---

## 🎨 第三阶段：配置审核信息

### 步骤 4：添加订阅审核信息

每个订阅组都需要配置审核信息，确保 Apple 能够测试订阅功能。

#### 4.1 审核信息配置

在"订阅"页面，点击"审核信息"：

**必填信息：**
1. **订阅用户名**: `testuser@example.com`
2. **订阅密码**: `Test1234`
3. **共享密钥**: 用于收据验证（可选，但推荐）

**测试账号信息：**
- 在"沙盒测试员"中创建测试账号
- 提供测试账号的 Apple ID 和密码

#### 4.2 审核说明

在"App 审核信息"部分添加：

**订阅说明：**
```
本 App 提供三种通行证订阅：

1. 探索者通行证：适合新手玩家
2. 领主通行证：中级玩家首选
3. 末日通行证：高级玩家专享

订阅提供以下权益：
- 资源生产加速加成
- 背包容量扩展
- VIP 专属标识
- 特殊功能解锁

订阅自动续费，用户可随时取消。
试用7天后自动转为付费订阅。
```

---

## 📸 第四阶段：准备审核截图

### 步骤 5：准备截图素材

为 App Store 审核准备以下截图：

#### 5.1 订阅页面截图

需要展示：
- 订阅产品列表（3个通行证）
- 月付/年付价格展示
- 试用说明
- 权益详情展示
- 恢复购买按钮

**截图尺寸要求：**
- iPhone: 6.7" (1290x2796) 或 6.5" (1242x2688)
- iPad: 12.9" (2048x2732) 或 11" (1668x2388)

#### 5.2 购买流程截图

需要展示：
- 订阅详情页面
- 购买确认弹窗
- Apple Pay Sheet（系统支付界面）
- 购买成功反馈
- 恢复购买功能

#### 5.3 物资商城截图

需要展示：
- 补给包列表
- 补给包详情
- 购买确认
- 邮箱/待领取页面

---

## ✅ 第五阶段：配置检查清单

### 提交前检查

在提交审核前，请确认以下所有项目：

- [ ] 3个订阅组已创建，ID正确
- [ ] 9个订阅产品已创建（每组3个）
- [ ] 4个消耗品已创建
- [ ] 所有产品的 Product ID 与代码完全一致
- [ ] 价格已设置为中国区 CNY 价格
- [ ] 所有产品已添加中文简体本地化
- [ ] 订阅审核信息已填写
- [ ] 沙盒测试账号已创建
- [ ] 截图已准备并上传
- [ ] 订阅条款和隐私政策链接已在 App 内提供

---

## 🧪 第六阶段：沙盒测试

### 步骤 6：创建沙盒测试账号

1. **在 App Store Connect 中：**
   - 进入"用户和角色"
   - 选择"沙盒测试员"
   - 点击"+"添加测试员

2. **测试账号信息：**
   - 使用真实的 Apple ID 邮箱格式
   - 密码需符合 Apple 要求（8位以上，包含数字和字母）
   - 测试账号不能与真实 Apple ID 相同

3. **在设备上测试：**
   - iOS 设置 -> iTunes Store 与 App Store
   - 登录沙盒测试账号
   - 运行 App，测试购买流程

---

## 🔧 价格等级对照表

### 中国区价格配置

| 价格等级 | CNY | USD | 适用产品 |
|----------|-----|-----|----------|
| Level 1 | ¥1 | $0.99 | - |
| Level 2 | ¥6 | $0.99 | 幸存者补给包 |
| Level 3 | ¥12 | $1.99 | 探索者月付 |
| Level 4 | ¥18 | $2.99 | 探险家补给包 |
| Level 5 | ¥25 | $3.99 | 领主月付 |
| Level 6 | ¥30 | $4.99 | 领主补给包 |
| Level 7 | ¥50 | $7.99 | 末日月付 |
| Level 8 | ¥68 | $9.99 | 霸主补给包 |
| Level 9 | ¥88 | $11.99 | 探索者年付 |
| Level 10 | ¥168 | $23.99 | 领主年付 |
| Level 11 | ¥328 | $47.99 | 末日年付 |

**注意：** 实际价格等级可能因 Apple 调整而变化，请以 App Store Connect 显示为准。

---

## 📞 审核提示

### Apple 审核注意事项

1. **必须提供恢复购买功能**
   - 你的 App 已实现（在订阅页面）
   - 确保用户可以恢复之前的购买

2. **必须明确显示价格**
   - 你的 App 已从 StoreKit 获取本地化价格
   - 确保 UI 中正确显示价格

3. **试用说明必须清晰**
   - 7天试用后会自动转为付费订阅
   - 需要在 UI 中明确说明

4. **订阅条款链接**
   - 在订阅页面提供"订阅条款"链接
   - 提供隐私政策链接

5. **沙盒测试测试账号**
   - 提供至少一个沙盒测试账号供审核使用
   - 确保测试账号信息正确填写在审核信息中

---

## 🎯 完成后的下一步

完成 App Store Connect 配置后：

1. ✅ **第一阶段**: 调整价格参数（已完成）
2. ✅ **第二阶段**: 物资商城优化（已完成）
3. ✅ **第三阶段**: App Store Connect 配置（本文档）
4. ⏳ **第四阶段**: 沙盒测试
5. ⏳ **第五阶段**: 真机测试

### 沙盒测试步骤：

1. 创建沙盒测试账号
2. 在 Xcode 中配置 Bundle Identifier 和 Team
3. 运行 App 到真机
4. 测试购买流程：
   - 点击购买
   - 确认 Apple Pay Sheet
   - 完成支付
   - 验证物品是否到账
   - 测试恢复购买
   - 测试订阅续期

---

## 📝 产品 ID 速查表

### 订阅产品 ID

```
探索者通行证:
- com.earthlord.sub.explorer.monthly
- com.earthlord.sub.explorer.yearly
- com.earthlord.sub.explorer.trial

领主通行证:
- com.earthlord.sub.lord.monthly
- com.earthlord.sub.lord.yearly
- com.earthlord.sub.lord.trial

末日通行证:
- com.earthlord.sub.apocalypse.monthly
- com.earthlord.sub.apocalypse.yearly
- com.earthlord.sub.apocalypse.trial
```

### 消耗品产品 ID

```
- com.earthlord.supply.survivor
- com.earthlord.supply.explorer
- com.earthlord.supply.lord
- com.earthlord.supply.overlord
```

---

**文档版本**: 1.0
**最后更新**: 2026-02-25
**状态**: 等待配置
