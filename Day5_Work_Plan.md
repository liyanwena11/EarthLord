# ğŸ¯ Day 5 å·¥ä½œè®¡åˆ’ - æœ€ç»ˆé›†æˆå’Œä¼˜åŒ–

## ğŸ“‹ Day 5 ç›®æ ‡

å®Œæˆ Phase 1 Week 1 çš„æœ€åå†²åˆºï¼Œä½¿ Tier æƒç›Šç³»ç»Ÿè¾¾åˆ°ç”Ÿäº§å°±ç»ªçŠ¶æ€ã€‚

**ç›®æ ‡å®Œæˆåº¦**: Day 4-5 â†’ 85% â†’ 100% âœ…

---

## ğŸ“Š å½“å‰çŠ¶æ€ (Day 4 ç»“æŸ)

### âœ… å·²å®Œæˆ (85%)

**Week 1 æ ¸å¿ƒæ¶æ„**:
- [x] Day 1: Models + TierManager (700+ è¡Œ)
- [x] Day 2: IAPManager (387 è¡Œ)
- [x] Day 3: SubscriptionStoreView UI (514 è¡Œ)
- [x] Day 4: System Integration (32 è¡Œæ–°å¢)
  - [x] BuildingManager Tier é›†æˆ
  - [x] ProductionManager Tier é›†æˆ
  - [x] InventoryManager Tier é›†æˆ
  - [x] TierManager æ–¹æ³•é‡å†™

**ç¼–è¯‘çŠ¶æ€**: âœ… 0 é”™è¯¯ + 0 è­¦å‘Š

---

## ğŸ® Day 5 å·¥ä½œåˆ†è§£ (5 ä¸ªä»»åŠ¡ï¼Œé¢„è®¡ 4 å°æ—¶)

### 1ï¸âƒ£ å®Œæ•´åŠŸèƒ½éªŒè¯ (60 åˆ†é’Ÿ)

**ä»»åŠ¡æè¿°**:
- åœ¨æ¨¡æ‹Ÿå™¨ä¸­å®Œæ•´èµ°é€šè´­ä¹°â†’æƒç›Šåº”ç”¨â†’æ¸¸æˆä½“éªŒ æµç¨‹
- éªŒè¯æ‰€æœ‰ Tier ç­‰çº§ (Free, Pro, VIP) çš„æƒç›Šæ•ˆæœ

**éªŒè¯æ¸…å•**:
- [ ] æ— è´­ä¹° Tier çš„ç”¨æˆ· (Free):
  - buildSpeedMultiplier = 1.0
  - productionSpeedMultiplier = 1.0
  - maxCapacity = 100 kg

- [ ] Pro Tier ç”¨æˆ·:
  - buildSpeedMultiplier = 1.3 (å¿« 23%)
  - productionSpeedMultiplier = 1.3 (å¿« 23%)
  - maxCapacity = 125 kg (+25 kg)

- [ ] VIP Tier ç”¨æˆ·:
  - buildSpeedMultiplier = 1.8 (å¿« 44%)
  - productionSpeedMultiplier = 1.8 (å¿« 44%)
  - maxCapacity = 150 kg (+50 kg)

**æ‰§è¡Œæ­¥éª¤**:
```
1. å¯åŠ¨åº”ç”¨ â†’ è¿›å…¥ SubscriptionStoreView
2. ç‚¹å‡» Pro è®¢é˜… â†’ å®Œæˆæ¨¡æ‹Ÿè´­ä¹°
3. éªŒè¯ç”¨æˆ· Tier å·²æ›´æ–° â†’ æ‰“å¼€å»ºç­‘/ç”Ÿäº§ç•Œé¢
4. å¼€å§‹å»ºé€  (100 ç§’å»ºç­‘) â†’ è®¡æ—¶éªŒè¯å®Œæˆæ—¶é—´ â‰ˆ 77 ç§’
5. å¼€å§‹ç”Ÿäº§ (60 åˆ†é’Ÿ) â†’ è®¡æ—¶éªŒè¯å®Œæˆæ—¶é—´ â‰ˆ 46 åˆ†é’Ÿ
6. æ·»åŠ ç‰©å“è‡³ 120 kg â†’ éªŒè¯å®¹é‡é€šè¿‡
7. åˆ‡æ¢åˆ° VIP â†’ é‡å¤éªŒè¯ä½†é¢„æœŸæ—¶é—´æ›´çŸ­
```

**éªŒè¯å·¥å…·**:
- åº”ç”¨å†…è®¡æ—¶å™¨ (æ‰‹åŠ¨ç§’è¡¨)
- Xcode Console æ—¥å¿—è¾“å‡º
- Supabase Dashboard æ•°æ®åº“æŸ¥è¯¢

---

### 2ï¸âƒ£ æƒç›Šè¿‡æœŸå¤„ç†éªŒè¯ (30 åˆ†é’Ÿ)

**ä»»åŠ¡æè¿°**:
- éªŒè¯æƒç›Šè‡ªåŠ¨è¿‡æœŸæœºåˆ¶
- ç¡®ä¿è¿‡æœŸåç³»ç»Ÿæ­£ç¡®é‡ç½®

**éªŒè¯æ¸…å•**:
- [ ] è®¢é˜…æœ‰æ•ˆæœŸå†…æƒç›Šç”Ÿæ•ˆ
- [ ] è¶…è¿‡æœ‰æ•ˆæœŸåè‡ªåŠ¨æ£€æµ‹è¿‡æœŸ
- [ ] applyDefaultBenefits() è¢«è°ƒç”¨
- [ ] æ‰€æœ‰å€æ•°é‡ç½®ä¸º 1.0
- [ ] SubscriptionStoreView æ˜¾ç¤º "æ— æ´»è·ƒè®¢é˜…"

**æ‰§è¡Œæ­¥éª¤**:
```
1. è´­ä¹° Pro è®¢é˜… (æœ‰æ•ˆæœŸ 7 å¤©)
2. éªŒè¯æƒç›Šåº”ç”¨ (buildSpeedMultiplier = 1.3)
3. ä¿®æ”¹æ•°æ®åº“: expires_at = now - 1 ç§’ (æ¨¡æ‹Ÿè¿‡æœŸ)
4. ç­‰å¾… 120 ç§’ (TierManager æ£€æŸ¥å‘¨æœŸ)
5. éªŒè¯æƒç›Šé‡ç½® (buildSpeedMultiplier = 1.0)
6. è§‚å¯Ÿæ—¥å¿—è¾“å‡º
```

**æ•°æ®åº“ä¿®æ”¹** (Supabase Console):
```sql
UPDATE user_tiers 
SET expires_at = NOW() - INTERVAL '1 second'
WHERE user_id = 'USER_ID_HERE';
```

---

### 3ï¸âƒ£ å†…å­˜æ³„æ¼å’Œæ€§èƒ½ä¼˜åŒ– (30 åˆ†é’Ÿ)

**ä»»åŠ¡æè¿°**:
- éªŒè¯æƒç›Šåº”ç”¨è¿‡ç¨‹ä¸­æ— å†…å­˜æ³„æ¼
- ä¼˜åŒ–æƒç›Šåº”ç”¨çš„æ€§èƒ½

**æ£€æŸ¥æ¸…å•**:
- [ ] ç›‘æµ‹å†…å­˜ä½¿ç”¨ (ä½¿ç”¨ Xcode Memory Graph)
  - åº”ç”¨æƒç›Šå‰: ~50 MB
  - åº”ç”¨æƒç›Šå: ~50 MB (æ— æ˜¾è‘—å¢åŠ )
  - é‡ç½®æƒç›Šå: ~50 MB (æ­£ç¡®é‡Šæ”¾)

- [ ] Timer æ­£ç¡®ç®¡ç†
  - expirationCheckTimer åˆå§‹åŒ–æ­£ç¡®
  - deinit æ—¶æ­£ç¡® invalidate

- [ ] Async/Await æ­£ç¡®ä½¿ç”¨
  - æ— æ‚¬æŒ‚åç¨‹
  - æ— å¾ªç¯å¼•ç”¨ (self æ­£ç¡®ä½¿ç”¨ weak)

**å·¥å…·**:
- Xcode Memory Graph Debugger
- æ—¥å¿—è¾“å‡ºéªŒè¯ Timer ç”Ÿå‘½å‘¨æœŸ
- LeakCanary (å¦‚é›†æˆ)

---

### 4ï¸âƒ£ UI åé¦ˆä¼˜åŒ– (45 åˆ†é’Ÿ)

**ä»»åŠ¡æè¿°**:
- ä¼˜åŒ– SubscriptionStoreView çš„æƒç›Šæ˜¾ç¤º
- æ·»åŠ æƒç›Šç”Ÿæ•ˆåé¦ˆ

**æ”¹è¿›æ¸…å•**:

#### A. æƒç›Šä¿¡æ¯å¡ç‰‡
```
å½“å‰ Tier: Pro âœ¨
- å»ºç­‘åŠ é€Ÿ: 1.3x (å¿« 23%)
- ç”Ÿäº§åŠ é€Ÿ: 1.3x (å¿« 23%)
- èƒŒåŒ…å®¹é‡: +25 kg (125 kg æ€»å®¹é‡)
- æœ‰æ•ˆæœŸ: 2026-03-21
```

#### B. æƒç›Šç”Ÿæ•ˆåé¦ˆ
```
è´­ä¹°æˆåŠŸ! æƒç›Šå·²åº”ç”¨ âœ…
- âœ“ å»ºç­‘åŠ é€Ÿå·²å¯ç”¨
- âœ“ ç”Ÿäº§åŠ é€Ÿå·²å¯ç”¨
- âœ“ èƒŒåŒ…å®¹é‡å·²æ‰©å±•

è¿”å›æ¸¸æˆå¼€å§‹äº«å—! â†’
```

#### C. è¿‡æœŸå‰æé†’
```
è­¦å‘Š: æ‚¨çš„ Pro è®¢é˜…å°†åœ¨ 3 å¤©åè¿‡æœŸ
ç«‹å³ç»­è´¹è·å¾—ä¸é—´æ–­çš„é«˜çº§ä½“éªŒ â†’
```

**å®ç°ä½ç½®**:
- `SubscriptionStoreView.swift` - æ·»åŠ æƒç›Šé¢„è§ˆå¡ç‰‡
- `TierManager` - æƒç›Šåº”ç”¨æ—¶å‘é€é€šçŸ¥
- è€ƒè™‘æ·»åŠ  Toast æç¤º

---

### 5ï¸âƒ£ æ–‡æ¡£å’Œäº¤æ¥ (30 åˆ†é’Ÿ)

**ä»»åŠ¡æè¿°**:
- å®Œæˆ Phase 1 Week 1 çš„æœ€ç»ˆæ–‡æ¡£
- ä¸º Week 2 åšå¥½äº¤æ¥å‡†å¤‡

**æ–‡æ¡£æ¸…å•**:
- [x] Day 4 é›†æˆæ€»ç»“ (å·²å®Œæˆ)
- [x] Day 4 æµ‹è¯•æŒ‡å— (å·²å®Œæˆ)
- [ ] Day 5 é›†æˆéªŒè¯æŠ¥å‘Š (å¾…å¡«å……)
- [ ] Phase 1 å®Œæ•´æ¶æ„æ–‡æ¡£
- [ ] å·²çŸ¥é—®é¢˜å’Œæ”¹è¿›å»ºè®®
- [ ] Week 2 å¯åŠ¨æŒ‡å—

**æ–‡æ¡£å†…å®¹**:

#### Day 5 é›†æˆéªŒè¯æŠ¥å‘Š
```markdown
# Day 5 é›†æˆéªŒè¯æŠ¥å‘Š

## æµ‹è¯•ç¯å¢ƒ
- iOS ç‰ˆæœ¬: 15.0+
- è®¾å¤‡: iPhone 15 Simulator
- æµ‹è¯•æ—¶é—´: [DATE]

## åŠŸèƒ½éªŒè¯
- [x] Free Tier: buildSpeedMultiplier = 1.0
- [x] Pro Tier: buildSpeedMultiplier = 1.3
- [x] VIP Tier: buildSpeedMultiplier = 1.8
- ... (å…¶ä»–éªŒè¯é¡¹)

## æ€§èƒ½æŒ‡æ ‡
- åº”ç”¨æƒç›Šå»¶è¿Ÿ: XX ms
- å†…å­˜å¢åŠ : XX MB
- ... (å…¶ä»–æŒ‡æ ‡)

## é—®é¢˜åˆ—è¡¨
- [å¦‚æœ‰é—®é¢˜ï¼Œé€ä¸€åˆ—å‡º]

## ç­¾æ ¸
æµ‹è¯•é€šè¿‡: âœ… / âŒ
```

#### Phase 1 å®Œæ•´æ¶æ„æ–‡æ¡£
çº³å…¥:
- ç³»ç»Ÿè®¾è®¡ (Models, Managers, Views)
- æ•°æ®æµ (è´­ä¹° â†’ æƒç›Šåº”ç”¨ â†’ æ¸¸æˆä½“éªŒ)
- API é›†æˆ (IAP, Supabase)
- é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ
- æ€§èƒ½ä¼˜åŒ–å»ºè®®

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚è¡¥å……

### UserTier.getBenefit() æ–¹æ³•ç¡®è®¤

ç¡®ä¿ UserTier ä¸­æœ‰æ­£ç¡®çš„ getBenefit() æ–¹æ³•:

```swift
// UserTier.swift åº”è¯¥æœ‰:
static func getBenefit(for tierId: String) -> TierBenefit? {
    switch tierId {
    case "pro":
        return TierBenefit(
            tierId: "pro",
            buildSpeedMultiplier: 1.3,
            productionSpeedMultiplier: 1.3,
            inventoryCapacityBonus: 25,
            name: "Pro"
        )
    case "vip":
        return TierBenefit(
            tierId: "vip",
            buildSpeedMultiplier: 1.8,
            productionSpeedMultiplier: 1.8,
            inventoryCapacityBonus: 50,
            name: "VIP"
        )
    default:
        return nil
    }
}
```

**éªŒè¯**:
- [ ] UserTier.swift ä¸­å­˜åœ¨ getBenefit() æ–¹æ³•
- [ ] è¿”å›å€¼ä¸ TierBenefit æ¨¡å‹åŒ¹é…
- [ ] æ‰€æœ‰ Tier ç­‰çº§éƒ½æœ‰å®šä¹‰

---

### TierManager åˆå§‹åŒ–éªŒè¯

ç¡®ä¿ TierManager åœ¨åº”ç”¨å¯åŠ¨æ—¶æ­£ç¡®åˆå§‹åŒ–:

```swift
// EarthLordApp.swift
@main
struct EarthLordApp: App {
    @StateObject var tierManager = TierManager.shared
    
    var body: some Scene {
        WindowGroup {
            ContentView()
                .environmentObject(tierManager)
        }
    }
}
```

**éªŒè¯**:
- [ ] TierManager ä½œä¸º @StateObject æ³¨å…¥
- [ ] ç¯å¢ƒå˜é‡æ­£ç¡®ä¼ é€’åˆ° child views
- [ ] åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨ checkCurrentTier()

---

## ğŸ“ˆ è´¨é‡æŒ‡æ ‡

**ç›®æ ‡è¾¾æˆæ ‡å‡†**:

| æŒ‡æ ‡ | ç›®æ ‡ | å½“å‰ |
|------|------|------|
| ç¼–è¯‘é”™è¯¯ | 0 | âœ… 0 |
| ç¼–è¯‘è­¦å‘Š | 0 | âœ… 0 |
| åŠŸèƒ½å®Œæ•´æ€§ | 100% | âœ… 100% |
| æƒç›Šåº”ç”¨å»¶è¿Ÿ | < 100ms | _å¾…éªŒè¯_ |
| å†…å­˜æ³„æ¼ | 0 | _å¾…éªŒè¯_ |
| ä»£ç è¦†ç›–ç‡ | > 80% | _å¾…æµ‹_ |
| ç”¨æˆ·ä½“éªŒè¯„åˆ† | > 4.5/5 | _å¾…æµ‹_ |

---

## ğŸš€ Week 2 é¢„å‘Š

å®Œæˆ Phase 1 Week 1 åï¼ŒWeek 2 å°†èšç„¦:

1. **Territory & Defense ç³»ç»Ÿæ•´åˆ** (Day 6-7)
   - åœˆåœ°æƒç›Š
   - é˜²å¾¡åŠ å¼º

2. **Social & Trade ç³»ç»Ÿ** (Day 8-9)
   - é¢‘é“ç³»ç»Ÿ
   - äº¤æ˜“ç³»ç»Ÿ

3. **å®Œæ•´ App Store ä¸Šæ¶å‡†å¤‡** (Day 10)
   - æœ€ç»ˆæµ‹è¯•
   - ä¸Šæ¶æ¸…å•
   - AppStore é…ç½®

---

## âœ… Day 5 å®Œæˆæ£€æŸ¥è¡¨

### åŠŸèƒ½éªŒè¯
- [ ] Free Tier æƒç›ŠéªŒè¯ (1.0x å€æ•°)
- [ ] Pro Tier æƒç›ŠéªŒè¯ (1.3x å€æ•°)
- [ ] VIP Tier æƒç›ŠéªŒè¯ (1.8x å€æ•°)
- [ ] æƒç›Šè¿‡æœŸè‡ªåŠ¨æ£€æµ‹å’Œé‡ç½®
- [ ] æƒç›Šå‡çº§/é™çº§æ­£ç¡®å¤„ç†

### æ€§èƒ½éªŒè¯
- [ ] æ— å†…å­˜æ³„æ¼
- [ ] æƒç›Šåº”ç”¨ < 100ms
- [ ] è®¡æ—¶å™¨æ­£ç¡®ç®¡ç†

### æ–‡æ¡£å®Œæˆ
- [ ] Day 5 éªŒè¯æŠ¥å‘Šå®Œæˆ
- [ ] Phase 1 æ¶æ„æ–‡æ¡£å®Œæˆ
- [ ] Week 2 å¯åŠ¨æŒ‡å—å‡†å¤‡

### UI/UX ä¼˜åŒ–
- [ ] æƒç›Šæ˜¾ç¤ºå¡ç‰‡å®Œæˆ
- [ ] æƒç›Šç”Ÿæ•ˆåé¦ˆå®Œæˆ
- [ ] è¿‡æœŸæé†’å®Œæˆ

### æœ€ç»ˆäº¤æ¥
- [ ] ä»£ç  Review å®Œæˆ
- [ ] æ‰€æœ‰æ–‡ä»¶æäº¤ Git
- [ ] Week 2 å¯åŠ¨ä¸é˜»å¡

---

## ğŸ“ å¸¸è§é—®é¢˜

**Q1: æƒç›Šè¿˜æ²¡ç”Ÿæ•ˆæ€ä¹ˆåŠ?**
- A: æ£€æŸ¥ TierManager.updateUserTier() æ˜¯å¦è¢«è°ƒç”¨
- æ£€æŸ¥æ—¥å¿—è¾“å‡º: `âœ… [æƒç›Š] å·²åº”ç”¨ Tier pro æƒç›Šåˆ°æ‰€æœ‰ç³»ç»Ÿ`
- ç¡®è®¤ UserTier.getBenefit() è¿”å›æ­£ç¡®é…ç½®

**Q2: å»ºé€ æ—¶é—´æ²¡æœ‰åŠ å¿«?**
- A: éªŒè¯ buildSpeedMultiplier å·²æ›´æ–°: `print(BuildingManager.shared.buildSpeedMultiplier)`
- æ£€æŸ¥ startConstruction() ä¸­æ˜¯å¦æ­£ç¡®åº”ç”¨å€æ•°
- æŸ¥çœ‹æ•°æ®åº“ä¸­çš„ build_completed_at æ—¶é—´è®¡ç®—æ˜¯å¦æ­£ç¡®

**Q3: æƒç›Šè¿‡æœŸåæ²¡æœ‰é‡ç½®?**
- A: ç¡®è®¤ TierManager çš„ expirationCheckTimer æ­£ç¡®å¯åŠ¨ (120 ç§’å‘¨æœŸ)
- æ£€æŸ¥ checkTierExpiration() æ˜¯å¦æ­£ç¡®æ£€æµ‹è¿‡æœŸ
- éªŒè¯ applyDefaultBenefits() æ˜¯å¦è¢«è°ƒç”¨

---

**æ—¶é—´è¡¨**: Day 5 (é¢„è®¡ 4 å°æ—¶)
**ç›®æ ‡**: Phase 1 Week 1 å®Œæˆåº¦ 85% â†’ 100% âœ…
**äº¤æ¥**: Week 2 å¯åŠ¨ï¼Œæ— æŠ€æœ¯éšœç¢
