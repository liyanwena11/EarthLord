# EarthLord 探索功能测试指南

## 完整跳转流程验证

### 测试路径
资源Tab → POI列表 → 点击废弃超市 → 详情页 → 点击搜寻 → 看到结果 → 确认 → 返回

---

## 第一步：启动App并进入资源Tab

1. 运行App
2. 在底部Tab栏找到"资源"Tab（带有📦图标）
3. 点击"资源"Tab

**验证点：**
- ✅ 能看到"资源"页面
- ✅ 顶部有"交易模式"开关
- ✅ 有5个分段选择器：POI、背包、已购、领地、交易
- ✅ 默认选中"POI"分段

---

## 第二步：查看POI列表

在POI分段下，你应该看到：

**状态栏：**
- GPS坐标：30.6586, 104.0647
- 显示"附近发现 3 个地点"

**搜索按钮：**
- 大按钮"搜索附近POI"

**筛选工具栏：**
- 横向滚动的分类按钮：全部、医院、超市、工厂、药店、加油站

**POI列表（5个）：**
1. ✅ 废弃超市 - 已发现、有物资、150米
2. ❌ 医院废墟 - 已发现、已搜空、320米
3. ❔ 加油站 - 未发现
4. ✅ 药店废墟 - 已发现、有物资、280米
5. ❔ 工厂废墟 - 未发现

**验证点：**
- ✅ 能看到5个POI卡片
- ✅ 每个POI显示类型图标、名称、状态
- ✅ 已发现的POI显示距离
- ✅ 未发现的POI不显示距离

---

## 第三步：点击废弃超市

1. 在POI列表中找到"废弃超市"（第一个）
2. 点击这个卡片

**验证点：**
- ✅ 成功跳转到POI详情页
- ✅ 左上角有返回按钮
- ✅ 导航栏显示返回箭头

---

## 第四步：查看POI详情页

详情页应该显示：

**顶部大图区域（占1/3屏幕）：**
- 绿色渐变背景（超市类型颜色）
- 大型购物车图标
- 底部显示"废弃超市"和"超市"标签
- 右上角显示"已发现"徽章

**描述卡片：**
- 地点描述："一家大型连锁超市的废墟，货架倒塌，但仍有部分物资可搜刮"

**信息卡片：**
- 📍 距离：150米（蓝色）
- 📦 物资状态：有物资（绿色）
- ⚠️ 危险等级：低危（蓝色）
- 🗺️ 来源：地图数据

**操作按钮：**
- 主按钮（橙色渐变）："搜寻此POI"
- 两个小按钮："标记已发现"、"标记无物资"

**验证点：**
- ✅ 所有信息正确显示
- ✅ 渐变背景颜色正确
- ✅ 按钮可点击

---

## 第五步：点击"搜寻此POI"按钮

1. 点击橙色的"搜寻此POI"主按钮
2. 等待弹窗出现

**验证点：**
- ✅ 弹出探索结果页面（Sheet模态窗口）
- ✅ 弹窗从底部滑入
- ✅ 背景详情页变暗

---

## 第六步：查看探索结果页面

探索结果页应该显示：

**成就标题（带入场动画）：**
- 大型地图图标（带光环效果）
- "探索完成！"大标题
- "成功完成了一次探索旅程"副标题

**统计数据卡片：**

📊 **行走距离**
- 本次：2500米 / 累计：15000米
- 排名：#42（绿色徽章）

🗺️ **探索面积**
- 本次：5万平方米 / 累计：25万平方米
- 排名：#38（绿色徽章）

⏱️ **探索时长**
- 30分钟

🎯 **额外信息**
- 发现 2 个POI（黄色标签）
- +350 XP（橙色标签）

**奖励物品卡片：**
- 标题："获得物品"（带礼物图标）
- 物品列表：
  1. 木材 x5（带绿色对勾）
  2. 矿泉水 x3（带绿色对勾）
  3. 罐头食品 x2（带绿色对勾）
- 底部："已添加到背包"提示

**确认按钮：**
- 橙色渐变按钮："确定"（带右箭头图标）
- 带发光阴影效果

**验证点：**
- ✅ 所有元素依次带动画出现
- ✅ 数据正确显示
- ✅ 排名徽章为绿色
- ✅ 物品有绿色对勾

---

## 第七步：点击"确定"按钮

1. 点击底部的"确定"按钮
2. 观察弹窗关闭

**验证点：**
- ✅ 弹窗向下滑出并关闭
- ✅ 返回到POI详情页
- ✅ 详情页状态保持不变

---

## 第八步：返回POI列表

1. 点击左上角的返回按钮（<）
2. 返回到POI列表

**验证点：**
- ✅ 成功返回POI列表
- ✅ 列表状态保持不变
- ✅ 滚动位置保持不变

---

## 第九步：测试其他分段

1. 点击"背包"分段

**验证点：**
- ✅ 切换到背包页面
- ✅ 能看到背包容量卡片
- ✅ 能看到8种物品
- ✅ 可以搜索和筛选

2. 点击"已购"、"领地"、"交易"分段

**验证点：**
- ✅ 显示"功能开发中"占位页面
- ✅ 有对应的图标和文字

---

## 第十步：测试返回按钮

1. 从任意分段返回上一级
2. 点击底部其他Tab
3. 再回到资源Tab

**验证点：**
- ✅ 返回按钮正常工作
- ✅ Tab切换正常
- ✅ 返回资源Tab后状态保持

---

## 额外测试功能

### 测试POI筛选
1. 在POI列表点击"超市"分类
2. 验证只显示超市类型的POI

### 测试背包搜索
1. 切换到背包分段
2. 在搜索框输入"木"
3. 验证只显示包含"木"的物品

### 测试交易开关
1. 点击顶部的交易开关
2. 验证开关状态变化（图标变绿）

### 测试POI详情页按钮
1. 在POI详情页点击"标记已发现"
2. 验证状态变化
3. 点击"标记无物资"
4. 验证"搜寻此POI"按钮变灰且禁用

---

## 技术实现总结

### 导航结构
```
ResourcesTabView (NavigationStack)
  └─ POIListContentView
      └─ NavigationLink → POIDetailView
          └─ .sheet → ExplorationResultView
              └─ dismiss() → 返回 POIDetailView
          └─ 返回按钮 → 返回 POIListContentView
```

### 数据传递
- POIListView → POIDetailView：传递 `POIPoint` 对象
- POIDetailView → ExplorationResultView：传递 `ExplorationResult` 对象
- ExplorationResultView → dismiss：关闭弹窗，无数据传递

### 状态管理
- @State：管理页面内部状态（搜索、筛选、弹窗显示）
- @Environment(\.dismiss)：用于关闭Sheet弹窗
- NavigationStack：管理导航栈

---

## 预期结果

✅ 整个流程流畅无卡顿
✅ 所有动画正常播放
✅ 返回按钮工作正常
✅ 数据正确传递和显示
✅ 弹窗正常打开和关闭
✅ Tab切换不会丢失状态

---

## 常见问题排查

### 问题1：点击POI卡片没有跳转
**解决方案：**
- 检查是否在 NavigationStack 内
- 确认 NavigationLink 包裹正确

### 问题2：搜寻按钮点击后没有弹窗
**解决方案：**
- 检查 showExplorationResult 状态
- 确认 .sheet 修饰符存在

### 问题3：确定按钮点击后弹窗不关闭
**解决方案：**
- 检查 @Environment(\.dismiss) 声明
- 确认 dismiss() 调用正确

### 问题4：返回按钮消失
**解决方案：**
- 检查 NavigationStack 是否正确嵌套
- 确认没有隐藏导航栏

---

## 测试完成检查清单

- [ ] 能进入资源Tab
- [ ] 能看到POI列表
- [ ] 能点击POI进入详情页
- [ ] 能看到POI详细信息
- [ ] 能点击搜寻按钮
- [ ] 能看到探索结果弹窗
- [ ] 能点击确定关闭弹窗
- [ ] 能用返回按钮返回列表
- [ ] 能切换到背包分段
- [ ] 能看到背包物品
- [ ] 能切换其他分段看到占位页面
- [ ] 交易开关可以切换
- [ ] POI筛选功能正常
- [ ] 背包搜索功能正常

---

## 开发者注意事项

### 已实现的功能
✅ 完整的导航流程
✅ POI列表和详情展示
✅ 背包管理功能
✅ 探索结果弹窗
✅ 分段选择器
✅ 搜索和筛选功能
✅ 假数据支持

### 待实现的功能
⏳ 真实的GPS定位
⏳ 网络请求和数据同步
⏳ 已购物品功能
⏳ 领地资源管理
⏳ 交易市场功能
⏳ 物品使用和存储逻辑
⏳ 真实的探索计算

---

测试愉快！🎮
