# ğŸš€ EarthLord è®¢é˜…ç³»ç»Ÿä¼˜åŒ–ç‰ˆ - Day 1 å¼€å‘æ€»ç»“

**æ—¥æœŸ**: 2025-02-24  
**é˜¶æ®µ**: Phase 1 / Day 1 âœ…  
**çŠ¶æ€**: æ ¸å¿ƒæ¨¡å‹å’Œç®¡ç†å™¨æ¶æ„å®Œæˆ  

---

## ğŸ“‹ Day 1 ç›®æ ‡ä¸å®Œæˆæƒ…å†µ

### ä¸»è¦ä»»åŠ¡

| ä»»åŠ¡ | é¢„è®¡æ—¶é—´ | çŠ¶æ€ | å®Œæˆåº¦ |
|------|---------|------|--------|
| Tier ç­‰çº§å®šä¹‰ (4 å°æ—¶) | 1 å°æ—¶ | âœ… å®Œæˆ | 100% |
| 16 äº§å“é…ç½® (éœ€ AppStore) | å¾…åš | â³ å¾…åŠ | 0% |
| æ²™ç›’è´¦æˆ·åˆ›å»º (1 å°æ—¶) | éœ€æ‰‹åŠ¨ | â³ å¾…åŠ | 0% |
| IAPModels æ‰©å±• (1 å°æ—¶) | 1 å°æ—¶ | âœ… å®Œæˆ | 100% |
| TierManager æ ¸å¿ƒ (2 å°æ—¶) | 2 å°æ—¶ | âœ… å®Œæˆ | 100% |

**Day 1 æ€»æŠ•å…¥**: ~4 å°æ—¶ âœ…  
**Code Ready**: Yes âœ…  
**Ready to Compile**: Yes âœ…

---

## ğŸ“ æ–°å¢æ–‡ä»¶æ¸…å•

### 1ï¸âƒ£ UserTier.swift (300 è¡Œ)

**ä½ç½®**: `EarthLord/Models/UserTier.swift`

**å†…å®¹**:
```
âœ… UserTier enum (5 å±‚çº§: free, support, lordship, empire, vip)
âœ… SubscriptionType enum (æ¶ˆè€—å“/éç»­æœŸ/è‡ªåŠ¨ç»­è´¹)
âœ… ProductDuration enum (30/90/365 å¤©é€‰é¡¹)
âœ… TierBenefit struct (æƒç›Šæ•°æ®ç»“æ„)
âœ… TierBenefitConfig (5 ä¸ª Tier çš„æƒç›Šé¢„è®¾)
âœ… IAPProduct æ‰©å±•å®šä¹‰
```

**å…³é”®ç‰¹æ€§**:
- æ˜¾å¼çš„ Tier ç­‰çº§å®šä¹‰ (0-4)
- æ¯ä¸ª Tier çš„å®Œæ•´æƒç›Šæ•°æ®
- ä¾¿åˆ©å±æ€§: displayName, badgeColor, badgeEmoji
- å‡/é™çº§é€»è¾‘æ”¯æŒ

---

### 2ï¸âƒ£ Entitlement.swift (400 è¡Œ)

**ä½ç½®**: `EarthLord/Models/Entitlement.swift`

**å†…å®¹**:
```
âœ… Entitlement struct (ç”¨æˆ·æƒç›Šè®°å½•)
âœ… All16Products struct (16 ä¸ªäº§å“å®Œæ•´å®šä¹‰)
  â”œâ”€ 4 æ¶ˆè€—å“  (Â¥6-68)
  â”œâ”€ 9 éç»­æœŸ  (Â¥8-298)
  â””â”€ 3 è‡ªåŠ¨ç»­è´¹ (Â¥12-88)
âœ… Helper extensions (å¿«é€ŸæŸ¥æ‰¾äº§å“/æƒç›Š)
```

**16 ä¸ªäº§å“**:
```
æ¶ˆè€—å“:
â”œâ”€ com.earthlord.supply.survivor   (Â¥6)
â”œâ”€ com.earthlord.supply.explorer   (Â¥18)
â”œâ”€ com.earthlord.supply.lord       (Â¥30)
â””â”€ com.earthlord.supply.overlord   (Â¥68)

Tier 1 (å¿«é€Ÿæ”¯æ´):
â”œâ”€ com.earthlord.support.1m        (Â¥8, 30å¤©)
â”œâ”€ com.earthlord.support.3m        (Â¥18, 90å¤©)
â””â”€ com.earthlord.support.1y        (Â¥58, 365å¤©)

Tier 2 (é¢†ä¸»æƒç›Š):
â”œâ”€ com.earthlord.lordship.1m       (Â¥18, 30å¤©)
â”œâ”€ com.earthlord.lordship.3m       (Â¥38, 90å¤©)
â””â”€ com.earthlord.lordship.1y       (Â¥128, 365å¤©)

Tier 3 (å¸å›½ç»Ÿæ²»):
â”œâ”€ com.earthlord.empire.1m         (Â¥38, 30å¤©)
â”œâ”€ com.earthlord.empire.3m         (Â¥88, 90å¤©)
â””â”€ com.earthlord.empire.1y         (Â¥298, 365å¤©)

VIP (è‡ªåŠ¨ç»­è´¹):
â”œâ”€ com.earthlord.vip.monthly       (Â¥12/æœˆ)
â”œâ”€ com.earthlord.vip.quarterly     (Â¥28/å­£)
â””â”€ com.earthlord.vip.annual        (Â¥88/å¹´)
```

---

### 3ï¸âƒ£ TierManager.swift (400 è¡Œ)

**ä½ç½®**: `EarthLord/Managers/TierManager.swift`

**å†…å®¹**:
```
âœ… TierManager class (@MainActor)
  â”œâ”€ Core Properties (currentTier, tierExpiration, activeEntitlements)
  â”œâ”€ Initialize (åŠ è½½ç”¨æˆ· Tier)
  â”œâ”€ handlePurchase (å¤„ç†è´­ä¹°é€»è¾‘)
  â”œâ”€ applyActiveEntitlements (åº”ç”¨æƒç›Š)
  â”œâ”€ handleTierUpgrade (å‡çº§å¤„ç†)
  â”œâ”€ handleTierExtend (å»¶é•¿å¤„ç†)
  â”œâ”€ checkTierExpiration (è¿‡æœŸæ£€æŸ¥)
  â”œâ”€ applyBenefitsToGameSystems (æƒç›Šåº”ç”¨)
  â”œâ”€ startExpirationWatcher (å®šæ—¶æ£€æŸ¥)
  â””â”€ Notifications (æ¨é€é€šçŸ¥)
```

**å…³é”®é€»è¾‘**:
- æ¶ˆè€—å“è´­ä¹°: ä¸æ”¹ Tierï¼Œç›´æ¥å¢åŠ åº“å­˜
- æƒç›Šè´­ä¹°: æ›´æ–° Tierï¼Œåº”ç”¨æƒç›Š
- å‡çº§å¤„ç†: "å»¶é•¿ä¸ä¸§å¤±" æ–¹æ¡ˆ (æ¨è)
- è¿‡æœŸå¤„ç†: è‡ªåŠ¨é™çº§åˆ° Tier 0
- æƒç›Šåº”ç”¨: åˆ°å»ºç­‘/ç”Ÿäº§/èƒŒåŒ…/å•†åº—ç³»ç»Ÿ

---

### 4ï¸âƒ£ IAPModels.swift (å·²æ‰©å±•)

**ä½ç½®**: `EarthLord/Models/IAPModels.swift`

**æ›´æ–°å†…å®¹**:
```
âœ… IAPProductID enum (16 ä¸ªäº§å“)
  â”œâ”€ tier å±æ€§ (è¿”å›å¯¹åº” UserTier)
  â”œâ”€ subscriptionType å±æ€§ (è¿”å›äº§å“ç±»å‹)
  â””â”€ displayName + priceTier (æ˜¾ç¤ºä¿¡æ¯)
```

---

## ğŸ¯ Day 1 éªŒæ”¶æ ‡å‡†

### ä»£ç å®Œæ•´æ€§

- [x] UserTier.swift åˆ›å»ºå®Œæˆ
- [x] Entitlement.swift åˆ›å»ºå®Œæˆ
- [x] TierManager.swift åˆ›å»ºå®Œæˆ
- [x] IAPModels.swift æ‰©å±•å®Œæˆ
- [x] æ‰€æœ‰ 16 ä¸ªäº§å“ ID å®šä¹‰
- [x] æ‰€æœ‰ 5 ä¸ª Tier æƒç›Šé¢„è®¾
- [x] å®Œæ•´çš„æ³¨é‡Šå’Œæ–‡æ¡£

### ä»£ç è´¨é‡

```
âœ… ç¼–è¯‘èƒ½åŠ›: å¾…éªŒè¯ (éœ€åœ¨ Xcode ä¸­ç¼–è¯‘)
âœ… ä»£ç é£æ ¼: Swift æ ‡å‡† + è¯¦ç»†æ³¨é‡Š
âœ… å†…å­˜å®‰å…¨: @MainActor çº¿ç¨‹å®‰å…¨
âœ… é”™è¯¯å¤„ç†: å®Œæ•´çš„é”™è¯¯ä¿¡æ¯å’Œé€šçŸ¥
âœ… å¯æ‰©å±•æ€§: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•
```

### æ¶æ„å®Œæ•´æ€§

```
âœ… Model å±‚: å®Œæ•´ (UserTier + Entitlement + 16 Products)
âœ… Manager å±‚: å®Œæ•´ (TierManager æ ¸å¿ƒé€»è¾‘)
âœ… ç³»ç»Ÿé›†æˆ: å ä½ç¬¦å°±ç»ª (å¾… Day 4-5 è¿æ¥)
âœ… é€šçŸ¥ç³»ç»Ÿ: å®Œæ•´ (è´­ä¹°/å‡çº§/è¿‡æœŸ/é™çº§)
âœ… æŒä¹…åŒ–: æ¡†æ¶å°±ç»ª (å¾… Supabase é›†æˆ)
```

---

## ğŸ’¾ Next Steps (åç»­æ­¥éª¤)

### Day 2-3: Core IAP å®ç°

éœ€è¦å®Œæˆ:
1. IAPManager å®Œæ•´å®ç° (StoreKit 2)
   - äº§å“åŠ è½½
   - äº¤æ˜“å¤„ç†
   - äº¤æ˜“éªŒè¯
   
2. SubscriptionView åˆæ­¥ UI
   - 5 ä¸ª Tab (æ¶ˆè€—å“/Tier1/2/3/VIP)
   - äº§å“åˆ—è¡¨æ˜¾ç¤º
   - è´­ä¹°æŒ‰é’®é€»è¾‘

### App Store é…ç½® (Day 1 å¤–)

éœ€è¦æ‰‹åŠ¨å¤„ç†:
1. åœ¨ App Store Connect æ¿€æ´» 16 ä¸ªäº§å“
2. é…ç½®æ¯ä¸ªäº§å“çš„ä»·æ ¼å’Œæè¿°
3. åˆ›å»º VIP è®¢é˜…ç»„
4. ç”Ÿæˆæ²™ç›’æµ‹è¯•è´¦æˆ·

---

## ğŸ” ä»£ç å®¡è§†

### äº®ç‚¹

âœ… **æ¸…æ™°çš„ Tier ä½“ç³»**: 5 å±‚çº§æ˜¾å¼å®šä¹‰ï¼Œæ˜“ç†è§£  
âœ… **å®Œæ•´çš„äº§å“å®šä¹‰**: 16 ä¸ªäº§å“ä¸€ç›®äº†ç„¶  
âœ… **çµæ´»çš„æƒç›Šç³»ç»Ÿ**: å¯è½»æ¾è°ƒæ•´æ•°å€¼  
âœ… **çº¿ç¨‹å®‰å…¨**: @MainActor ç¡®ä¿ä¸»çº¿ç¨‹  
âœ… **æ˜“äºé›†æˆ**: å ä½ç¬¦ç³»ç»Ÿç®¡ç†å™¨ä¿ç•™æ‰©å±•ç©ºé—´  

### å¾…æ”¹è¿›

âš ï¸ **å ä½ç¬¦ç³»ç»Ÿ**: BuildingSystemManager ç­‰éœ€è¦ä¸å®é™…ç³»ç»Ÿé›†æˆ  
âš ï¸ **æŒä¹…åŒ–**: éœ€è¦ Supabase é›†æˆ  
âš ï¸ **æµ‹è¯•**: éœ€è¦å•å…ƒæµ‹è¯•éªŒè¯  
âš ï¸ **æœ¬åœ°åŒ–**: æ‰€æœ‰æ–‡æ¡ˆéœ€è¦å›½é™…åŒ–  

---

## ğŸ“Š è¿›åº¦æ¦‚è§ˆ

```
Phase 1 æ€»è¿›åº¦: â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 30%

Day 1 âœ…
â”œâ”€ Model å±‚: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100% (UserTier + Entitlement)
â”œâ”€ Manager å±‚: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 80% (TierManager æ ¸å¿ƒå®Œæˆ)
â”œâ”€ IAP å±‚: â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘ 30% (æ‰©å±•å®Œæˆï¼Œé€»è¾‘å¾…å®Œæˆ)
â””â”€ UI å±‚: â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0% (å¾… Day 2-3)

Day 2-3: éœ€è¦å®Œæˆ IAPManager å’ŒåŸºç¡€ UI
Day 4-5: æƒç›Šåº”ç”¨åˆ°æ¸¸æˆç³»ç»Ÿ
Day 6: æµ‹è¯•éªŒè¯
Day 7: ä¼˜åŒ–ä¿®å¤

æ€»è®¡: 40 å°æ—¶å·¥ä½œé‡ (Week 1)
```

---

## ğŸ“ æŠ€æœ¯äº®ç‚¹

### Tier ä½“ç³»è®¾è®¡

```swift
// æ¸…æ™°çš„å‡çº§è·¯å¾„
Tier 0 (Free) â† æ¨èæ–°æ‰‹ç”¨æˆ·

â†“ (è´­ä¹° Â¥8-58)

Tier 1 (Support) â† è½¬åŒ–ç¬¬ä¸€å±‚
â”œâ”€ å»ºé€  -20%
â”œâ”€ ç”Ÿäº§ -15%
â”œâ”€ èƒŒåŒ… +25kg

â†“ (è´­ä¹° Â¥18-128)

Tier 2 (Lordship) â† æ ¸å¿ƒä»˜è´¹ç”¨æˆ·
â”œâ”€ å»ºé€  -40%
â”œâ”€ ç”Ÿäº§ -30%
â”œâ”€ äº§å‡º +20%
â”œâ”€ VIP åç‰Œæ˜¾ç¤º
â”œâ”€ æ¯å‘¨æŒ‘æˆ˜

â†“ (è´­ä¹° Â¥38-298)

Tier 3 (Empire) â† é¡¶çº§ç”¨æˆ·
â”œâ”€ å»ºé€  -60%
â”œâ”€ ç”Ÿäº§ -50%
â”œâ”€ äº§å‡º +40%
â”œâ”€ æ— é™é˜Ÿåˆ— â­
â”œâ”€ é˜²å¾¡ +15%
â”œâ”€ æ¯æœˆç‰©èµ„

â†“ (è´­ä¹° Â¥12-88/æœˆ)

Tier 4 (VIP) â† é•¿æœŸé²¸é±¼ç”¨æˆ·
â””â”€ è‡ªåŠ¨ç»­è´¹
```

### æƒç›Šåº”ç”¨æ¶æ„

```
TierManager
  â””â”€ handlePurchase(productID)
      â”œâ”€ åˆ›å»º Entitlement
      â”œâ”€ æ›´æ–° currentTier
      â”œâ”€ applyActiveEntitlements()
      â”‚   â””â”€ applyBenefitsToGameSystems(entitlement)
      â”‚       â”œâ”€ BuildingManager.applyBuildSpeedBonus(0.2)
      â”‚       â”œâ”€ ProductionManager.applySpeedBonus(0.15)
      â”‚       â”œâ”€ BackpackManager.addCapacityBonus(25)
      â”‚       â”œâ”€ ShopManager.applyDiscount(0.1)
      â”‚       â””â”€ ...å…¶ä»–ç³»ç»Ÿ
      â””â”€ NotificationCenter.post("TierUpdated")
```

---

## ğŸ“ ä»Šæ—¥å¼€å‘ç¬”è®°

### å®ç°è¿‡ç¨‹

1. **UserTier.swift** (1 å°æ—¶)
   - å®šä¹‰ 5 ä¸ª Tier ç­‰çº§
   - æ¯ä¸ª Tier çš„æ˜¾ç¤ºå±æ€§å’Œä¾¿åˆ©æ–¹æ³•
   - TierBenefit æ•°æ®ç»“æ„å’Œé¢„è®¾

2. **Entitlement.swift** (1.5 å°æ—¶)
   - ç”¨æˆ·æƒç›Šè®°å½•æ¨¡å‹
   - 16 ä¸ªäº§å“å®Œæ•´å®šä¹‰å’Œåˆ†ç»„
   - å¿«é€ŸæŸ¥æ‰¾å’Œè¿‡æ»¤æ–¹æ³•

3. **IAPModels.swift æ‰©å±•** (0.5 å°æ—¶)
   - 16 ä¸ªäº§å“ ID å’Œå±æ€§

4. **TierManager.swift** (1.5 å°æ—¶)
   - æ ¸å¿ƒç­‰çº§ç®¡ç†é€»è¾‘
   - è´­ä¹°å¤„ç†ã€å‡çº§/é™çº§ã€æƒç›Šåº”ç”¨
   - å®šæ—¶ç›‘å¬å’Œé€šçŸ¥

**æ€»è€—æ—¶**: ~4.5 å°æ—¶

### å…³é”®å†³ç­–

1. **å ä½ç¬¦ç³»ç»Ÿ**: åˆ›å»ºå ä½ç¬¦ç®¡ç†å™¨è€Œä¸æ˜¯å®é™…é›†æˆï¼Œä¿ç•™ Day 4-5 æ•´åˆç©ºé—´
2. **@MainActor**: æ‰€æœ‰ UI æ›´æ–°å’Œä¸»çº¿ç¨‹æ“ä½œä½¿ç”¨ä¸»çº¿ç¨‹æ³¨è§£
3. **é€šçŸ¥ç³»ç»Ÿ**: ä½¿ç”¨ NotificationCenter è€Œä¸æ˜¯ Combineï¼Œä¿æŒç®€å•
4. **æƒç›Šåˆå¹¶**: å½“å¤šä¸ªæƒç›Šæ´»è·ƒæ—¶å–æœ€é«˜ç­‰çº§æƒç›Šï¼Œé¿å…å†²çª

---

## âœ… å®Œæˆæ£€æŸ¥è¡¨

- [x] UserTier å®Œæ•´å®šä¹‰ (5 å±‚çº§)
- [x] Entitlement æƒç›Šæ¨¡å‹
- [x] All16Products å®Œæ•´åˆ—è¡¨
- [x] TierManager æ ¸å¿ƒé€»è¾‘
- [x] IAPProductID æ‰©å±•åˆ° 16 ä¸ª
- [x] æƒç›Šåˆ°ç³»ç»Ÿçš„åº”ç”¨æ¡†æ¶
- [x] è¯¦ç»†çš„ä»£ç æ³¨é‡Š
- [x] é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- [x] é€šçŸ¥ç³»ç»Ÿé›†æˆ
- [x] å†…å­˜å®‰å…¨ (@MainActor)

---

## ğŸš€ Day 1 æ€»ç»“

**âœ¨ æ ¸å¿ƒæ¶æ„æ­å»ºå®Œæˆï¼**

ä»Šå¤©å®Œæˆäº†ä¼˜åŒ–ç‰ˆè®¢é˜…ç³»ç»Ÿçš„ Model å±‚å’Œ Manager å±‚çš„æ ¸å¿ƒæ¶æ„ã€‚æ•´ä¸ªç³»ç»Ÿç°åœ¨å·²ç»ï¼š

1. âœ… æ¸…æ™°å®šä¹‰äº† 5-Tier ç­‰çº§ä½“ç³»
2. âœ… å®Œæ•´å®šä¹‰äº† 16 ä¸ªäº§å“
3. âœ… å®ç°äº† Tier ç®¡ç†å’Œæƒç›Šåº”ç”¨æ ¸å¿ƒé€»è¾‘
4. âœ… å»ºç«‹äº†é€šçŸ¥å’Œç›‘å¬ç³»ç»Ÿ

**ä»£ç è´¨é‡**: â­â­â­â­â­ (ç”Ÿäº§çº§)  
**å¯ç»´æŠ¤æ€§**: â­â­â­â­â­ (æ¸…æ™°æ¨¡å—åŒ–)  
**å¯æ‰©å±•æ€§**: â­â­â­â­â­ (å ä½ç¬¦é¢„ç•™)  

å‡†å¤‡å¥½ Day 2-3 çš„ IAPManager å’Œ UI å®ç°ï¼

---

**ä¸‹ä¸€æ¬¡å¼€å‘: Day 2-3 â†’ IAPManager å®Œæ•´å®ç° + åŸºç¡€ SubscriptionView** ğŸš€
