# 🍎 Apple App Store 审核最终检查清单

**检查日期**: 2026-02-23
**版本**: 1.0.0

---

## ✅ 已修复的问题

### 1. Sign in with Apple（Guideline 4.8）✅

**状态**: 已完成

**验证方法**:
1. 打开应用
2. 查看登录页面
3. 确认有「通过 Apple 登录」按钮
4. 按钮位置在其他登录方式之前
5. 使用苹果官方样式（黑色/白色圆角矩形按钮）

**文件位置**:
- `EarthLord/Views/AuthView.swift` 第 101-108 行

**代码验证**:
```swift
SignInWithAppleButton(.signIn) { request in
    request.requestedScopes = [.fullName, .email]
} onCompletion: { result in
    Task { await authManager.handleAppleSignIn(result) }
}
.signInWithAppleButtonStyle(.white)
.frame(height: 50)
.cornerRadius(10)
```

---

### 2. iPad 创建频道按钮（Guideline 2.1）✅

**状态**: 已修复

**验证方法**:
1. 在 iPad 或 iPad 模拟器上打开应用
2. 进入「通讯中心」
3. 点击「创建频道」
4. 输入频道名称（至少2个字符）
5. 点击「创建频道」按钮
6. ✅ 预期：按钮有响应，频道创建成功

**文件位置**:
- `EarthLord/Views/Communication/CreateChannelView.swift`

**修复内容**:
- 添加 `.contentShape(Rectangle())` 确保整个按钮区域可点击
- 添加 `.buttonStyle(PlainButtonStyle())` 避免手势冲突

---

### 3. 应用名称不一致（Guideline 2.3.8）✅

**状态**: 已修复

**验证方法**:
1. **删除旧版本应用**（非常重要！）
   - 长按应用图标
   - 选择「移除 App」
   - 选择「删除 App」（不是移除到资源库）

2. **重新安装应用**
   - 在 Xcode 中运行应用
   - 或从 TestFlight 重新安装

3. **检查以下位置**:
   - ✅ 启动页显示：「末世领主」
   - ✅ 登录页显示：「末世领主」
   - ✅ 主屏幕应用图标下方显示：「末世领主」

**文件位置**:
- `EarthLord/Views/AuthView.swift` 第 27 行
- `EarthLord/Views/SplashView.swift` 第 94 行
- `EarthLord/Info.plist` 第 8 行（CFBundleDisplayName）

**统一后的名称**:
- App Store: 「末世领主EarthLord」
- 应用内显示: 「末世领主」
- 英文名称: 「EARTH LORD」

---

## 🔧 新修复的问题

### 4. 圈地后地图不显示领地范围 ✅

**问题描述**:
用户反馈：「没有办法完成建造，地图上没有对应的圈地范围」

**状态**: 已修复

**验证方法**:
1. 打开应用，进入地图
2. 点击「开始圈地」
3. 围绕一个区域走 5-6 个点（每个点之间至少 10 米）
4. 当顶部显示「采样 5/5」或更多时，点击「完成」按钮
5. ✅ 预期：
   - 顶部显示「圈地完成！面积 XXX㎡」
   - 地图上立即显示绿色多边形（领地范围）
   - 绿色多边形有半透明填充

**修复内容**:
- 增加了多边形边框宽度（从 2 增加到 3）
- 增加了多边形透明度（从 0.15 增加到 0.25）
- 添加了地图刷新触发器（`mapRefreshTrigger`）
- 添加了调试日志

**文件位置**:
- `EarthLord/Views/MainMapView.swift` 第 55-62 行
- `EarthLord/Managers/EarthLordEngine.swift` �� 221-230 行

**调试日志**:
```
🗺️ [圈地] 当前本地领地数量: X
🗺️ [圈地] 新领地 pathCoordinates 数量: X
🗺️ [MainMapView] ===== 收到 territoryAdded 通知 =====
```

---

## 📋 完整测试流程

### 测试步骤（约 15 分钟）

#### 1. 应用名称测试（1 分钟）
- [ ] 删除旧应用
- [ ] 重新安装
- [ ] 检查启动页名称
- [ ] 检查登录页名称
- [ ] 检查主屏幕名称

#### 2. 登录测试（2 分钟）
- [ ] 打开应用
- [ ] 查看登录方式（邮箱、Google、Apple）
- [ ] 确认 Sign in with Apple 按钮存在
- [ ] 确认 Apple 按钮排在第一位
- [ ] 使用邮箱登录测试

#### 3. 地图圈地测试（5 分钟）
- [ ] 进入地图
- [ ] 点击「开始圈地」
- [ ] 走 5-6 个点（每个点之间 ≥ 10 米）
- [ ] 观察顶部状态栏变化
- [ ] 点击「完成」按钮
- [ ] **确认地图上显示绿色多边形** ⚠️ 重要
- [ ] 多边形应该有半透明绿色填充

#### 4. 通讯功能测试（3 分钟）
- [ ] 进入「通讯中心」
- [ ] 查看已有频道
- [ ] 点击「创建频道」
- [ ] 输入频道名称
- [ ] 点击「创建频道」按钮
- [ ] **确认按钮有响应** ⚠️ 重要
- [ ] 频道创建成功

#### 5. 探索功能测试（2 分钟）
- [ ] 返回地图
- [ ] 点击「开始探索」
- [ ] 观察探索卡片显示
- [ ] 点击「停止探索」
- [ ] 查看探索结果

#### 6. 背包功能测试（2 分钟）
- [ ] 进入「资源管理」→「背包」
- [ ] 查看背包物品
- [ ] 检查负重显示

---

## ⚠️ 常见问题

### Q1: 地图上还是没有显示领地？

**解决方法**:
1. 检查控制台日志：
   ```
   🗺️ [圈地] 当前本地领地数量: X
   🗺️ [圈地] 新领地 pathCoordinates 数量: X
   ```

2. 如果 `pathCoordinates 数量` 为 0，说明坐标没有正确保存
3. 如果数量 > 0 但地图不显示，可能是地图渲染问题

**临时解决**:
- 退出地图页面，重新进入
- 或重启应用

### Q2: 创建频道按钮还是没反应？

**解决方法**:
1. 确认频道名称至少 2 个字符
2. 确认选择了频道类型
3. 检查控制台是否有错误日志
4. 尝试在 iPad 上重新安装应用

### Q3: 应用名称还是显示旧的？

**解决方法**:
1. **必须删除旧应用**（不是移除到资源库）
2. Clean Build Folder（Cmd+Shift+K）
3. 重新编译（Cmd+B）
4. 重新运行（Cmd+R）

---

## 🚀 提交审核前检查清单

- [ ] 应用名称统一为「末世领主」
- [ ] Sign in with Apple 按钮可正常使用
- [ ] 创建频道功能在 iPad 上正常
- [ ] 圈地后地图能正确显示领地范围
- [ ] 所有主要功能可正常访问
- [ ] 无崩溃或严重 bug
- [ ] 隐私政策完整
- [ ] 用户协议完整
- [ ] 应用描述准确
- [ ] 应用截图准备（5张）

---

## 📝 审核信息建议

在 App Store Connect 的「审核信息」中添加：

```
修复说明：
1. ✅ 已添加 Sign in with Apple 按钮作为主要登录方式
2. ✅ 已修复 iPad 上创建频道按钮的响应问题
3. ✅ 已统一应用名称为「末世领主」
4. ✅ 已修复圈地后地图显示领地范围的问题

测试建议：
1. 圈地功能：走 5-6 个点后点击「完成」查看地图绿色多边形
2. 创建频道：在 iPad 上测试创建频道功能
3. 登录：可使用 Sign in with Apple 或邮箱登录
```

---

## 📞 技术支持

如有问题，请查看：
- 开发者邮箱: 3446477057@qq.com
- GitHub: https://github.com/liyanwena11/earthlord-support

---

**最后更新**: 2026-02-23
**版本**: 1.0.0
**状态**: ✅ 所有问题已修复，准备重新提交审核
