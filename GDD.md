# 游戏设计文档 (GDD)
## 地球新主 (EarthLord)

---

## 文档信息

- **游戏名称**: 地球新主 (EarthLord)
- **游戏类型**: LBS生存建造游戏
- **平台**: iOS (iPhone)
- **目标市场**: 全球
- **目标年龄**: 16+
- **文档版本**: 1.0
- **创建日期**: 2025-12-30

---

## 目录

1. [游戏概念](#1-游戏概念)
2. [世界观与故事](#2-世界观与故事)
3. [核心游戏循环](#3-核心游戏循环)
4. [游戏机制详细设计](#4-游戏机制详细设计)
5. [进度系统](#5-进度系统)
6. [经济系统](#6-经济系统)
7. [社交系统](#7-社交系统)
8. [美术风格](#8-美术风格)
9. [音效与音乐](#9-音效与音乐)
10. [UI/UX设计](#10-uiux设计)
11. [新手引导](#11-新手引导)
12. [游戏平衡性](#12-游戏平衡性)

---

## 1. 游戏概念

### 1.1 核心理念

**"用脚步丈量你的王国"**

地球新主是一款将现实世界行走与虚拟世界建造结合的创新型游戏。玩家通过GPS定位在真实世界中圈占领地,探索废墟获取资源,建造家园,并与其他玩家进行交易和社交。

### 1.2 核心玩法三支柱

1. **探索 (Exploration)**: Walk to Earn
   - 在真实世界行走发现POI
   - 搜刮废墟获得资源
   - 解锁新区域和隐藏地点

2. **建造 (Building)**: 资源管理与建设
   - 消耗资源建造建筑
   - 升级建筑提升效率
   - 布局优化提升产出

3. **生存 (Survival)**: 资源消耗与挑战
   - 管理饥饿和口渴
   - 维护建筑和装备
   - 应对随机事件

### 1.3 游戏特色

- **真实地理**: 基于Apple MapKit的真实地图和POI
- **位置社交**: 基于地理位置的玩家互动
- **硬核生存**: 时间衰减的生存体征系统
- **公平交易**: 玩家间的物物交换经济
- **多语言**: 支持5种语言,面向全球市场

### 1.4 游戏目标

**短期目标** (每天):
- 完成每日探索,获取资源
- 维持生存体征在安全范围
- 完成每日任务

**中期目标** (每周):
- 扩大领地面积
- 建造新建筑
- 升级现有建筑
- 完成成就

**长期目标** (每月/每季度):
- 登上排行榜
- 收集稀有资源
- 解锁所有建筑
- 建立强大的交易网络

---

## 2. 世界观与故事

### 2.1 背景设定

#### 时间线

**2048年 - 终末战争**
- 持续时间: 72小时
- 后果: 全球文明崩塌,99%人口消失
- 原因: [玩家自行想象,游戏不明确解释]

**2048-2051年 - 沉寂期**
- 幸存者躲在避难所
- 自然开始复苏
- 旧世界秩序彻底瓦解

**2051年 - 新纪元开始**
- 幸存者走出避难所
- 《新开拓者协议》颁布
- 玩家的故事从这里开始

### 2.2 《新开拓者协议》

> **"凡以双足丈量之无主土地,皆为开拓者所有。"**

#### 核心法则

1. **土地归属**: 用脚步圈出的无主土地归开拓者所有
2. **开拓义务**: 必须在30天内开始建设,90天内保持活跃
3. **资源共享**: 废墟中的资源属于发现者
4. **公平交易**: 鼓励玩家间的物物交换
5. **互助协作**: 联盟和团队合作是生存关键

### 2.3 世界状态

#### 环境特征

- **废墟城市**: 原有的城市建筑大部分保留但已废弃
- **自然复苏**: 植物开始在废墟中生长
- **资源稀缺**: 食物、水、药品都需要搜刮
- **危险与机遇**: 某些区域资源丰富但可能有危险

#### POI类型与背景

| POI类型 | 背景故事 | 资源类型 |
|---------|---------|---------|
| 医院/药店 | 战争期间最后的救治点 | 药品、医疗用品 |
| 超市/餐厅 | 曾经的食物储备地 | 罐头食品、饮用水 |
| 工厂/工地 | 工业遗迹 | 金属、工具 |
| 公园/林地 | 自然恢复最快的地方 | 木材、植物纤维 |
| 银行/珠宝店 | 旧世界的财富象征 | 稀有材料、电子元件 |

### 2.4 视觉风格: 希望朋克 (Hopepunk)

**不是末日废土,而是重生之地**

- **色调**: 不是灰暗的废土色,而是带有生机的绿色和暖色调
- **对比**: 破败的建筑 vs 新生的植物
- **氛围**: 虽然文明崩塌,但充满希望和新生的感觉
- **符号**: 绿色幼苗、修复的建筑、闪亮的新建标志

#### 参考作品
- The Last of Us (植物覆盖的城市)
- Horizon Zero Dawn (自然与科技废墟的结合)
- 但整体氛围更明亮、更有希望感

---

## 3. 核心游戏循环

### 3.1 核心循环图

```
┌─────────────────────────────────────────────────────────────┐
│                      游戏核心循环                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   登录注册 → 圈地占领 → 探索搜刮 → 获得资源                   │
│      ↑                              ↓                       │
│      │         ┌──────────────────────────────┐            │
│      │         │  资源用途:                    │            │
│      │         │  • 建造建筑 (消耗资源)         │            │
│      │         │  • 交易换物 (流通资源)         │            │
│      │         │  • 生存消耗 (食物/水)          │            │
│      │         └──────────────────────────────┘            │
│      │                              ↓                       │
│      └──────── 通讯社交 ← 成就排行 ← 发展壮大               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 每日循环 (Session Loop)

#### 典型游戏会话 (20-30分钟)

1. **登录** (1分钟)
   - 查看生存体征
   - 领取每日任务
   - 查看消息通知

2. **规划** (2分钟)
   - 查看背包资源
   - 确定今日目标(圈地/探索/建造)
   - 规划行走路线

3. **行动** (15-20分钟)
   - 出门行走
   - 圈占新领地 或 探索POI
   - 获得资源

4. **建设** (5分钟)
   - 使用资源建造建筑
   - 升级现有建筑
   - 发布交易挂单

5. **社交** (5分钟)
   - 查看附近玩家
   - 公共频道聊天
   - 查看排行榜

### 3.3 长期循环 (Meta Loop)

#### 玩家成长路径

```
新手 (Lv 1-5)
   ↓
[学习基础玩法: 圈地、探索、建造]
   ↓
初级开拓者 (Lv 6-15)
   ↓
[扩大领地、收集资源、建立交易]
   ↓
中级领主 (Lv 16-30)
   ↓
[优化布局、稀有建筑、排行榜竞争]
   ↓
高级统治者 (Lv 31-50)
   ↓
[全地图控制、联盟领袖、赛季竞技]
   ↓
传奇开拓者 (Lv 50+)
```

---

## 4. 游戏机制详细设计

### 4.1 圈地机制 (Territory Claiming)

#### 4.1.1 圈地规则

**基础要求**:
- 最小面积: 100 m²
- 最大面积: 100,000 m² (10公顷)
- 最小边长: 10米
- 最大边数: 100个顶点
- 闭合容差: 起点和终点距离<20米

**限制条件**:
1. **不可重叠**: 不能与其他玩家的领地重叠
2. **GPS真实性**: 移动速度不能超过15 km/h (跑步速度)
3. **形状合理性**: 不能是极度扭曲的形状
4. **数量限制**:
   - 免费用户: 最多3块领地
   - 月卡用户: 最多10块领地
   - 通行证用户: 无限制

#### 4.1.2 圈地流程

```
1. 点击"开始开拓"
   ↓
2. 开始记录GPS轨迹 (蓝色线条)
   ↓
3. 玩家行走,轨迹实时绘制
   ↓
4. 回到起点附近(<20米)
   ↓
5. 自动检测闭合
   ↓
6. 验证合法性:
   - 检查重叠
   - 检查作弊
   - 检查面积
   ↓
7. 验证通过 → 领地创建 (绿色多边形)
   验证失败 → 显示错误原因
```

#### 4.1.3 领地状态

| 状态 | 条件 | 可用功能 |
|------|------|---------|
| 激活 | 正常使用中 | 全部功能 |
| 待激活 | 圈地后30天内未建造 | 仅可建造 |
| 警告 | 60天未活跃 | 提示即将回收 |
| 回收 | 90天未活跃 | 领地被系统回收 |

#### 4.1.4 领地效益

**基础效益**:
- 可以建造建筑
- 可以发布交易
- 显示在地图上

**面积奖励**:
- 1,000-5,000 m²: 建筑上限+2
- 5,000-10,000 m²: 建筑上限+5, 每日资源+10%
- 10,000-50,000 m²: 建筑上限+10, 每日资源+20%
- 50,000+ m²: 建筑上限+20, 每日资源+50%

---

### 4.2 探索机制 (Exploration)

#### 4.2.1 POI发现

**触发条件**:
- 玩家进入POI 50米范围
- 该POI不在冷却期内
- 玩家探索次数未达上限

**POI冷却时间**:
- 普通POI: 24小时
- 稀有POI: 72小时
- 传说POI: 7天

**探索次数限制**:
- 免费用户: 5次/天
- 月卡用户: 无限次
- 通行证用户: 无限次+范围扩大

#### 4.2.2 搜刮奖励

**奖励计算公式**:
```
基础奖励 = POI等级 × 随机系数 (0.8 - 1.2)
最终奖励 = 基础奖励 × 玩家等级加成 × VIP加成 × 体征加成
```

**POI等级分类**:

| POI类型 | 等级 | 基础奖励倍率 | 稀有物品概率 |
|---------|------|-------------|-------------|
| 住宅区 | 1 | 1x | 5% |
| 商业区 | 2 | 1.5x | 10% |
| 工业区 | 3 | 2x | 15% |
| 医疗区 | 4 | 2.5x | 20% |
| 特殊地标 | 5 | 3x | 30% |

**奖励物品表** (示例: 超市):

| 物品 | 概率 | 数量范围 |
|------|------|---------|
| 罐头食品 | 80% | 10-30 |
| 饮用水 | 80% | 10-30 |
| 布料 | 40% | 5-15 |
| 药品 | 20% | 3-8 |
| 工具 | 10% | 1-3 |
| 稀有材料 | 5% | 1-2 |

#### 4.2.3 探索成就追踪

每次探索记录:
- 探索距离 (从上次位置到当前位置)
- 探索时长
- 获得物品清单
- 发现的POI类型

累计统计:
- 总探索次数
- 总探索距离
- 总探索时长
- 不同POI类型的发现次数

---

### 4.3 资源系统 (Resource System)

#### 4.3.1 资源分类

**基础资源** (Common):
- 木材 (Wood): 建造基础材料
- 石头 (Stone): 建造基础材料
- 金属 (Metal): 升级材料
- 布料 (Cloth): 生产材料

**消耗品** (Consumable):
- 罐头食品 (Canned Food): 恢复饱食度+30
- 饮用水 (Water): 恢复水分+40
- 药品 (Medicine): 恢复生命+20
- 急救包 (First Aid Kit): 恢复生命+50

**生产材料** (Crafting):
- 铁矿石 (Iron Ore): 冶炼成金属
- 原木 (Log): 加工成木材
- 植物纤维 (Plant Fiber): 加工成布料
- 石块 (Rock): 加工成石头

**稀有资源** (Rare):
- 电子元件 (Electronics): 高级建筑材料
- 精密工具 (Precision Tools): 建造加速
- 能源核心 (Energy Core): 能源建筑材料
- 卫星模块 (Satellite Module): 通讯升级材料

**特殊资源** (Special):
- 金币 (Coins): 游戏内货币,完成任务获得
- 钻石 (Diamonds): 高级货币,付费或稀有奖励

#### 4.3.2 资源获取途径

| 资源类型 | 主要获取途径 | 次要获取途径 |
|---------|-------------|-------------|
| 基础资源 | 探索POI | 玩家交易 |
| 消耗品 | 探索POI | 农田生产、交易 |
| 生产材料 | 探索特定POI | 生产建筑 |
| 稀有资源 | 稀有POI、成就 | 付费购买、交易 |
| 金币 | 每日任务、成就 | 建筑产出 |
| 钻石 | 付费购买 | 稀有成就奖励 |

#### 4.3.3 背包管理

**容量限制**:
- 基础容量: 100格
- 小仓库: +50格
- 中仓库: +100格
- 大仓库: +200格
- 月卡加成: +50格

**物品堆叠**:
- 基础资源: 最多999/格
- 消耗品: 最多99/格
- 工具/装备: 不可堆叠
- 稀有资源: 最多99/格

**整理功能**:
- 自动排序 (按类型/稀有度/数量)
- 一键整理
- 快速查找
- 收藏标记

---

### 4.4 建造系统 (Building System)

#### 4.4.1 建筑分类与功能

**生存类建筑** (Survival):

| 建筑 | 等级 | 建造成本 | 功能 |
|------|------|---------|------|
| 篝火 | T1 | 石头×20, 木材×30 | 提供照明和温暖 |
| 简易庇护所 | T1 | 木材×50, 布料×20 | 基础休息点 |
| 木屋 | T2 | 木材×150, 石头×100 | 高级休息点,恢复生命 |
| 堡垒 | T3 | 石头×300, 金属×150 | 防御建筑,生命恢复+50% |

**储存类建筑** (Storage):

| 建筑 | 等级 | 建造成本 | 功能 |
|------|------|---------|------|
| 小仓库 | T1 | 木材×50, 石头×30 | 背包容量+50 |
| 中仓库 | T2 | 木材×150, 石头×100, 金属×50 | 背包容量+100 |
| 大仓库 | T3 | 石头×300, 金属×200 | 背包容量+200 |
| 智能仓库 | T3 | 金属×200, 电子元件×50 | 容量+300,自动分类 |

**生产类建筑** (Production):

| 建筑 | 等级 | 建造成本 | 功能 | 产出 |
|------|------|---------|------|------|
| 农田 | T1 | 木材×40, 种子×10 | 生产食物 | 罐头食品×20/天 |
| 水井 | T1 | 石头×60, 工具×5 | 生产水 | 饮用水×30/天 |
| 工作台 | T2 | 木材×100, 金属×50 | 加工材料 | 消耗原料生产成品 |
| 熔炉 | T2 | 石头×150, 金属×100 | 冶炼金属 | 铁矿石→金属 |
| 药品站 | T3 | 金属×200, 电子×50 | 制作药品 | 药品×10/天 |

**能源类建筑** (Energy):

| 建筑 | 等级 | 建造成本 | 功能 |
|------|------|---------|------|
| 太阳能板 | T2 | 金属×100, 电子×30 | 提供能源,加快生产20% |
| 风力发电机 | T2 | 金属×150, 电子×50 | 提供能源,加快生产30% |
| 能源核心 | T3 | 金属×300, 能源核心×10 | 区域加成,所有建筑+50% |

#### 4.4.2 建筑状态机

```
[图纸] → 点击建造 → [建造中] (需要时间)
                           ↓
                       建造完成
                           ↓
                       [待激活] → 点击激活 → [运行中]
                                                  ↓
                                          时间流逝/使用
                                                  ↓
                                              [已损坏] → 维修 → [运行中]
                                                  ↓
                                            继续损坏
                                                  ↓
                                              [报废] → 拆除或重建
```

**状态详细说明**:

| 状态 | 说明 | 可用操作 |
|------|------|---------|
| 图纸 | 未建造,仅配方 | 查看需求 |
| 建造中 | 正在建造,需要时间 | 加速(消耗钻石) |
| 待激活 | 建造完成未启动 | 激活、拆除 |
| 运行中 | 正常工作 | 收获、升级、停用 |
| 已损坏 | 需要维修 | 维修、拆除 |
| 报废 | 完全损坏 | 拆除 |

#### 4.4.3 建造时间

| 建筑等级 | 基础建造时间 | 加速成本 |
|---------|------------|---------|
| T1 | 30分钟 | 10钻石 |
| T2 | 2小时 | 50钻石 |
| T3 | 6小时 | 150钻石 |

**时间加速**:
- VIP用户: 建造时间-20%
- 精密工具: 单次建造-50%
- 工作台加成: 同领地内建造-30%

#### 4.4.4 建筑升级

**升级规则**:
- 只能升级激活状态的建筑
- 升级消耗资源 = 下一等级建造成本 × 0.8
- 升级时间 = 下一等级建造时间 × 0.6
- 升级后保留原有功能,效率提升

**升级效果**:
- T1 → T2: 产出/效率 +50%
- T2 → T3: 产出/效率 +100%

---

### 4.5 交易系统 (Trading System)

#### 4.5.1 交易发现机制

**触发条件**:
- 进入其他玩家领地100米范围内
- 对方领地设置"允许交易"
- 对方有挂单

**交易列表显示**:
- 玩家昵称
- 距离
- 提供的物品
- 需要的物品
- 挂单时间

#### 4.5.2 交易流程

```
卖方:
1. 进入"交易"界面
2. 点击"发布交易"
3. 选择提供的物品和数量
4. 选择需要的物品和数量
5. 设置有效期 (24小时/3天/7天)
6. 确认发布
   ↓
[挂单成功,等待买家]

买方:
1. 发现附近的交易
2. 浏览交易列表
3. 查看交易详情
4. 点击"接受交易"
5. 检查自己是否有足够的物品
6. 确认交易
   ↓
[系统执行原子交换]
   ↓
交易成功: 双方物品互换,交易记录
交易失败: 资源不足或挂单已取消
```

#### 4.5.3 交易手续费

| 交易类型 | 手续费 |
|---------|--------|
| 普通交易 | 无 |
| 稀有物品交易 | 金币×100 |
| 跨地区交易(未来功能) | 金币×500 |

#### 4.5.4 交易限制

**防止刷资源**:
- 同一买卖双方24小时内最多交易3次
- 新注册用户7天内无法交易稀有物品
- 大额交易(总价值>1000金币)需要冷却时间

**反作弊**:
- 异常频繁交易触发人工审核
- 小号互刷检测
- IP地址检测

---

### 4.6 生存系统 (Survival System)

#### 4.6.1 生存体征指标

**核心生命 (Health)**:
- 范围: 0-100
- 降到0: 角色死亡
- 恢复方式:
  - 使用药品: +20
  - 使用急救包: +50
  - 庇护所休息: +5/小时 (需饱食和水分>50)
  - 自然恢复: 饱食和水分>80时, +2/小时

**饱食度 (Hunger)**:
- 范围: 0-100%
- 衰减速度: -5/小时
- 低于30: 生命-1/小时, 移动速度-20%
- 降到0: 生命-5/小时
- 恢复方式:
  - 罐头食品: +30
  - 烤肉: +50
  - 大餐: +80

**水分 (Thirst)**:
- 范围: 0-100%
- 衰减速度: -10/小时 (比饥饿快)
- 低于30: 生命-2/小时, 探索效率-30%
- 降到0: 生命-10/小时
- 恢复方式:
  - 饮用水: +40
  - 净化水: +60
  - 能量饮料: +80

#### 4.6.2 状态效果 (Buffs & Debuffs)

**正面效果**:

| 效果名称 | 触发条件 | 效果 | 持续时间 |
|---------|---------|------|---------|
| 充沛 | 饱食和水分>80 | 探索奖励+20%, 生命恢复+2/小时 | 持续 |
| 庇护所舒适 | 在木屋休息 | 生命恢复+10/小时 | 休息期间 |
| 饱餐一顿 | 饱食度达到100 | 探索效率+30% | 1小时 |
| 能量充沛 | 使用能量饮料 | 移动速度+30%, 探索冷却-50% | 30分钟 |

**负面效果**:

| 效果名称 | 触发条件 | 效果 | 持续时间 |
|---------|---------|------|---------|
| 饥饿 | 饱食度<30 | 生命-1/小时, 速度-20% | 直到进食 |
| 口渴 | 水分<30 | 生命-2/小时, 效率-30% | 直到饮水 |
| 重伤 | 生命<20 | 无法圈地和建造 | 直到治疗 |
| 濒死 | 生命<10 | 所有能力-50% | 直到治疗 |

#### 4.6.3 死亡与复活

**死亡惩罚**:
- 失去背包中10%的资源 (随机掉落)
- 所有建筑暂停运作24小时
- 生存天数重置 (但总天数保留)

**复活方式**:
1. 免费复活: 等待30分钟
2. 快速复活: 消耗稀有材料×10
3. 钻石复活: 消耗50钻石,立即复活且无惩罚

---

## 5. 进度系统

### 5.1 等级系统

#### 5.1.1 经验获取

| 行为 | 经验值 |
|------|--------|
| 圈地100m² | +10 XP |
| 探索一次POI | +50 XP |
| 建造T1建筑 | +30 XP |
| 建造T2建筑 | +80 XP |
| 建造T3建筑 | +200 XP |
| 完成交易 | +20 XP |
| 完成每日任务 | +100 XP |
| 完成成就 | +50-500 XP |

#### 5.1.2 等级奖励

| 等级 | 解锁内容 | 奖励 |
|------|---------|------|
| 2 | 交易系统 | 金币×100 |
| 5 | T2建筑 | 背包容量+10 |
| 10 | 频道系统 | 稀有材料×5 |
| 15 | T3建筑 | 金币×500 |
| 20 | 联盟系统 | 钻石×10 |
| 30 | 高级通讯 | 背包容量+20 |
| 50 | 全部功能 | 传说称号 |

### 5.2 成就系统

#### 5.2.1 成就分类

**新手成就** (引导功能):
- 第一步: 完成第一次圈地 → 金币×100
- 拾荒者: 完成第一次探索 → 金币×50
- 建造者: 建造第一个建筑 → 金币×80
- 社交家: 发送第一条消息 → 金币×30
- 商人: 完成第一次交易 → 金币×100

**进阶成就** (数量累积):
- 领地大亨: 拥有5块领地 → 金币×500
- 探险家: 探索100个POI → 稀有材料×10
- 建筑师: 建造50个建筑 → 钻石×5
- 交易商: 完成100次交易 → 金币×1000
- 生存者: 存活30天 → 传说称号

**稀有成就** (特殊条件):
- 孤岛领主: 圈占一个岛屿 → 钻石×20
- 废墟探险家: 探索所有类型的POI → 稀有称号
- 满载而归: 单次探索获得100个物品 → 金币×500
- 贸易大师: 单日完成10次交易 → 钻石×10

**隐藏成就** (不显示条件):
- 不眠之夜: 凌晨3点在线 → ？？？
- 环球旅行者: 在10个不同国家圈地 → ？？？
- 幸运儿: 探索获得传说物品 → ？？？

#### 5.2.2 成就奖励

| 稀有度 | 金币奖励 | 钻石奖励 | 特殊奖励 |
|-------|---------|---------|---------|
| 普通 | 50-100 | 0 | - |
| 稀有 | 200-500 | 0-5 | 称号/头像框 |
| 史诗 | 500-1000 | 5-10 | 独特建筑 |
| 传说 | 1000-5000 | 20-50 | 传说称号/特效 |

### 5.3 每日任务

#### 5.3.1 任务类型

**每日任务** (每天刷新):
- 探索任务: 探索3个POI → 金币×100, XP×50
- 圈地任务: 圈占500m²领地 → 金币×150, XP×80
- 建造任务: 建造或升级1个建筑 → 金币×200, XP×100
- 社交任务: 发送10条消息 → 金币×50, XP×30
- 交易任务: 完成1次交易 → 金币×150, XP×70

**每周任务** (每周一刷新):
- 大领主: 圈占总面积达到5000m² → 金币×1000, 稀有材料×5
- 勤劳的探险家: 探索20个POI → 金币×800, XP×500
- 建设狂魔: 建造10个建筑 → 金币×1200, 钻石×5

**特殊任务** (活动期间):
- 节日任务
- 赛季任务
- 限时挑战

---

## 6. 经济系统

### 6.1 货币系统

#### 6.1.1 货币类型

**金币 (Coins)**:
- 主要游戏内货币
- 获取途径: 每日任务、成就、建筑产出
- 用途: 交易手续费、加速建造、购买普通物品

**钻石 (Diamonds)**:
- 高级货币
- 获取途径: 付费购买、稀有成就
- 用途: 购买稀有物品、VIP订阅、快速复活

#### 6.1.2 金币获取与消耗平衡

**每日金币收入** (活跃玩家):
- 每日任务: +400
- 成就: +100 (平均)
- 建筑产出: +200
- 总计: ~700金币/天

**每日金币支出**:
- 交易手续费: -100
- 加速建造: -200 (可选)
- 购买物品: -200
- 总计: ~500金币/天

**结余**: +200金币/天 (鼓励储蓄用于大额消费)

### 6.2 资源经济循环

```
探索POI → 获得资源 → 分流:
                         ├→ 自用建造 → 产出资源 → 再次分流
                         ├→ 自用消耗 → 维持生存 → 继续探索
                         └→ 交易换物 → 获得需要的资源 → 建造/消耗
```

### 6.3 交易市场

#### 6.3.1 物品价值定位 (以金币计)

| 物品类型 | 基准价值 | 稀有度 |
|---------|---------|--------|
| 罐头食品 | 5金币/个 | 普通 |
| 饮用水 | 3金币/个 | 普通 |
| 木材 | 2金币/个 | 普通 |
| 石头 | 2金币/个 | 普通 |
| 金属 | 10金币/个 | 稀有 |
| 布料 | 8金币/个 | 稀有 |
| 药品 | 20金币/个 | 稀有 |
| 电子元件 | 100金币/个 | 传说 |
| 能源核心 | 200金币/个 | 传说 |

#### 6.3.2 交易税收 (回收货币)

**交易手续费**:
- 普通物品交易: 免费
- 稀有物品交易: 总价值的10%
- 传说物品交易: 总价值的15%

收取的金币进入系统回收,防止金币通胀。

---

## 7. 社交系统

### 7.1 通讯系统

#### 7.1.1 设备等级与功能

| 设备 | 解锁等级 | 升级成本 | 发送范围 | 功能 |
|------|---------|---------|---------|------|
| 收音机 | Lv 1 | 初始装备 | 0 (仅接收) | 只能接收公共频道 |
| 对讲机 | Lv 5 | 金属×100, 电子×10 | 3km | 收发公共频道 |
| 营地电台 | Lv 15 | 金属×300, 电子×50 | 10km | 收发+创建频道 |
| 卫星通讯 | Lv 30 | 卫星模块×10, 电子×200 | 全球 | 全部功能+私聊 |

#### 7.1.2 公共频道

**覆盖范围**: 3km半径
**消息可见**: 只有在范围内的玩家可见
**消息限制**:
- 免费用户: 10条/小时
- VIP用户: 无限制

**功能**:
- 发送文本消息
- 表情符号
- 位置分享
- 交易推广

#### 7.1.3 私人频道 (群组)

**创建条件**:
- 拥有营地电台或更高设备
- 消耗金币×500

**频道管理**:
- 频道名称和描述
- 公开/私密设置
- 成员管理 (踢出/禁言)
- 管理员设置

**频道类型**:
- 交易频道: 专门交易信息
- 联盟频道: 联盟成员内部
- 区域频道: 特定地区玩家

#### 7.1.4 PTT呼叫

**操作方式**:
- 长按麦克风按钮录音 (最长30秒)
- 松开自动发送
- 在选定频道广播

**使用限制**:
- 对讲机或更高设备
- 冷却时间: 10秒

### 7.2 联盟系统 (未来功能)

**联盟功能**:
- 创建联盟: Lv 20, 消耗钻石×100
- 联盟仓库: 共享资源
- 联盟任务: 协作完成大型目标
- 联盟战: 领地争夺
- 联盟排行榜

---

## 8. 美术风格

### 8.1 视觉主题: 希望朋克 (Hopepunk)

**核心理念**: 不是绝望的废土,而是重生的希望

#### 8.1.1 色彩方案

**主色调**:
- 生机绿 (#4CAF50): 代表新生、植物、希望
- 天空蓝 (#2196F3): 代表自由、探索、未来
- 暖橙色 (#FF9800): 代表篝火、温暖、家园

**辅助色**:
- 废墟灰 (#757575): 旧世界的遗迹
- 泥土棕 (#795548): 自然、土地
- 锈铁红 (#BF360C): 金属氧化、工业遗迹

**强调色**:
- 稀有紫 (#9C27B0): 稀有物品
- 传说金 (#FFC107): 传说物品
- 危险红 (#F44336): 警告、生命值低

#### 8.1.2 地图风格

**卫星地图**:
- 使用Apple MapKit卫星视图作为基础
- 叠加废土后处理滤镜:
  - 饱和度降低20%
  - 对比度提高15%
  - 绿色通道提升10% (突出植物)

**领地显示**:
- 自己的领地: 绿色半透明多边形 (透明度30%)
- 其他玩家领地: 蓝色边框
- 待激活领地: 黄色虚线边框
- 过期领地: 灰色半透明

**建筑图标**:
- 扁平化设计
- 明亮的颜色
- 清晰的剪影
- 带有轻微发光效果 (表示活跃)

#### 8.1.3 UI风格

**界面框架**:
- 半透明毛玻璃效果 (iOS风格)
- 圆角矩形 (12px radius)
- 微妙的阴影和高光
- 流畅的动画过渡

**按钮设计**:
- 主要按钮: 渐变色+轻微阴影
- 次要按钮: 边框样式
- 危险按钮: 红色背景
- 不可用按钮: 灰色+透明度50%

**卡片设计**:
- 白色/深色背景 (支持深色模式)
- 清晰的层次结构
- 图标+文字的信息布局
- 上滑/下滑交互

### 8.2 角色与建筑美术

#### 8.2.1 角色表现

**玩家标识**:
- 在地图上用圆形头像表示
- 移动时有方向指示箭头
- 自己: 蓝色光晕
- 其他玩家: 白色光晕

**角色系统** (未来功能):
- 可自定义头像
- 可选择性别和外观
- 不同服装和装备

#### 8.2.2 建筑视觉

**建筑进化**:
- T1: 简陋、临时的感觉 (木板、破布)
- T2: 更坚固、实用 (木材、砖石)
- T3: 高科技、现代化 (金属、玻璃、太阳能板)

**建筑状态**:
- 建造中: 施工图纸效果,半透明
- 待激活: 完整但无光效
- 运行中: 完整+发光/动画效果
- 已损坏: 破损、裂纹、烟雾效果

**建筑特效**:
- 篝火: 火焰动画+烟雾粒子
- 太阳能板: 反光效果
- 农田: 随风摇摆的植物
- 仓库: 门开关动画

### 8.3 图标设计

**物品图标**:
- 尺寸: 128x128px
- 风格: 手绘+扁平
- 背景: 稀有度对应的边框颜色
  - 普通: 灰色
  - 稀有: 蓝色
  - 史诗: 紫色
  - 传说: 金色

**建筑图标**:
- 尺寸: 256x256px
- 风格: 等距视角 (Isometric)
- 细节丰富,易于识别

---

## 9. 音效与音乐

### 9.1 背景音乐

#### 9.1.1 音乐风格

**主题**: Post-Apocalyptic Hope (后末日希望)

**特征**:
- 旋律: 简单、重复、易记
- 乐器: 吉他、钢琴、合成器、自然音效
- 节奏: 缓慢到中速,舒缓而坚定
- 情感: 孤独中的希望,废墟中的温暖

**参考音乐**:
- The Last of Us OST (Gustavo Santaolalla)
- Journey OST (Austin Wintory)
- Minecraft OST (C418)

#### 9.1.2 音乐分层

**探索模式**:
- 环境音: 风声、鸟叫、远处的废墟声
- 背景音乐: 轻柔的吉他+环境音
- 层次: 随着移动动态变化

**基地模式** (在自己领地内):
- 更温暖、更轻松的音乐
- 加入篝火噼啪声
- 放松的氛围

**战斗/紧张模式** (未来功能):
- 鼓点加入
- 节奏加快
- 音量提升

### 9.2 音效设计

#### 9.2.1 UI音效

| 交互 | 音效描述 |
|------|---------|
| 按钮点击 | 清脆的"咔哒"声 |
| 页面切换 | 轻微的"嗖"声 |
| 错误提示 | 短促的"咚"声 |
| 成功提示 | 明亮的"叮"声 |
| 菜单展开 | 流畅的"刷"声 |

#### 9.2.2 游戏音效

| 行为 | 音效描述 |
|------|---------|
| 圈地成功 | 上升的音阶+成功音效 |
| 探索发现 | 神秘的闪光音效 |
| 获得物品 | "叮叮"拾取音+物品掉落声 |
| 建造放置 | 锤子敲击声 |
| 建筑完成 | 建造完成的音乐提示 |
| 升级成功 | 华丽的升级音效 |
| 交易完成 | 硬币叮当声 |
| 消息收到 | 温和的提示音 |
| 生命值低 | 心跳声加强 |

#### 9.2.3 环境音效

| 场景 | 音效描述 |
|------|---------|
| 废墟探索 | 脚步声、风声、远处的废墟倒塌声 |
| 公园区域 | 鸟叫、树叶沙沙声 |
| 城市区域 | 空旷的回音、远处的机械声 |
| 自己的领地 | 篝火燃烧声、建筑运转声 |

### 9.3 音频设置

**音量控制**:
- 主音量
- 音乐音量
- 音效音量
- 环境音音量

**音频选项**:
- 静音模式
- 后台播放音乐开关
- 耳机自动检测

---

## 10. UI/UX设计

### 10.1 信息架构

```
主界面 (Tab Bar)
├── 地图 (Map)
│   ├── 卫星地图视图
│   ├── 开始圈地
│   ├── 我的领地列表
│   └── 附近玩家
│
├── 探索 (Explore)
│   ├── 附近POI列表
│   ├── 探索历史
│   ├── 探索统计
│   └── 搜刮按钮
│
├── 资源 (Resources)
│   ├── 背包 (物品列表)
│   ├── 建造 (建筑选择)
│   ├── 交易 (发布/浏览交易)
│   └── 生存体征
│
├── 通讯 (Communication)
│   ├── 消息中心
│   ├── 公共频道
│   ├── 频道列表
│   ├── PTT呼叫
│   └── 设备管理
│
└── 个人 (Profile)
    ├── 个人信息
    ├── 成就
    ├── 排行榜
    ├── 设置
    └── 订阅商店
```

### 10.2 核心界面设计

#### 10.2.1 地图界面

**布局**:
```
┌─────────────────────────────────┐
│  ☰  EarthLord         🔔  ⚙️   │ 顶部栏
├─────────────────────────────────┤
│                                 │
│                                 │
│         [卫星地图视图]            │
│        (领地、POI、玩家)          │
│                                 │
│               📍                │ 玩家位置
│                                 │
│                                 │
├─────────────────────────────────┤
│  [开始圈地]  [我的领地]  [附近POI] │ 快捷操作
└─────────────────────────────────┘
│     地图    探索   资源  通讯  我 │ Tab Bar
└─────────────────────────────────┘
```

**交互**:
- 双指缩放地图
- 单指拖动移动
- 点击领地查看详情
- 点击POI查看信息
- 长按标记位置

#### 10.2.2 圈地界面

**圈地进行中**:
```
┌─────────────────────────────────┐
│  ← 返回              停止圈地 ⏹  │
├─────────────────────────────────┤
│                                 │
│         [地图+轨迹线]             │
│                                 │
│        ━━━━━━━━━━━━━             │ 蓝色轨迹
│       ↑                         │
│      📍 你的位置                  │
│                                 │
├─────────────────────────────────┤
│ 📏 距离起点: 156m                │
│ ⏱ 用时: 5分23秒                  │
│ 📐 当前面积: ~2,450m²             │
└─────────────────────────────────┘
```

**闭合检测**:
```
┌─────────────────────────────────┐
│         检测到闭合!              │
│                                 │
│    [绿色多边形预览]               │
│                                 │
│  📐 面积: 2,003 m²               │
│  📏 周长: 183 m                  │
│                                 │
│  [取消]           [确认圈地] ✓  │
└─────────────────────────────────┘
```

#### 10.2.3 探索界面

**POI发现**:
```
┌─────────────────────────────────┐
│         发现兴趣点! 🎉           │
├─────────────────────────────────┤
│  📍 惠州白鹭湖喜来登度假酒店        │
│     - 盛宴标帜西餐厅              │
│                                 │
│  类型: 🍴 餐厅                   │
│  距离: 23m                      │
│  冷却: 可搜刮 ✓                  │
│                                 │
│  预计获得:                       │
│  🥫 罐头食品 x10-30              │
│  💧 饮用水 x10-30                │
│  🧵 布料 x5-15                   │
│                                 │
│  [取消]           [搜刮] 🔍     │
└─────────────────────────────────┘
```

**搜刮结果**:
```
┌─────────────────────────────────┐
│         探索成就 ⭐               │
├─────────────────────────────────┤
│  📏 探索距离: 1.50 km            │
│  ⏱ 用时: 6 min                  │
│                                 │
│  获得物品:                       │
│  ┌──────────────────────────┐  │
│  │ 🧵 布料 x7               │  │
│  │ 💊 药品 x10              │  │
│  │ 🥫 罐头食品 x24          │  │
│  └──────────────────────────┘  │
│                                 │
│  💰 金币 +50                     │
│  ✨ 经验 +50 XP                  │
│                                 │
│            [确定]               │
└─────────────────────────────────┘
```

#### 10.2.4 背包界面

```
┌─────────────────────────────────┐
│  ← 背包              整理 📋     │
├─────────────────────────────────┤
│  [全部] [食物] [材料] [工具] [稀有] │ 分类标签
├─────────────────────────────────┤
│  容量: ▓▓▓▓▓░░░░░ 41/100        │ 容量条
├─────────────────────────────────┤
│                                 │
│  [图标] 罐头食品          x24  › │
│  [图标] 饮用水            x18  › │
│  [图标] 木材              x156 › │
│  [图标] 石头              x89  › │
│  [图标] 金属              x23  › │
│  [图标] 布料              x45  › │
│  [图标] 药品              x12  › │
│  [图标] 电子元件          x3   › │
│                                 │
│         ...                     │
└─────────────────────────────────┘
```

#### 10.2.5 建造界面

```
┌─────────────────────────────────┐
│  ← 建造                         │
├─────────────────────────────────┤
│  [全部] [生存] [储存] [生产] [能源] │
├─────────────────────────────────┤
│                                 │
│  ┌──────────┐  ┌──────────┐   │
│  │ 🔥 篝火   │  │ 🏠 庇护所  │   │
│  │  T1      │  │  T1      │   │
│  │ 已解锁    │  │ 已解锁    │   │
│  └──────────┘  └──────────┘   │
│                                 │
│  ┌──────────┐  ┌──────────┐   │
│  │ 📦 小仓库  │  │ 🌾 农田   │   │
│  │  T1      │  │  T1      │   │
│  │ 已解锁    │  │ 已解锁    │   │
│  └──────────┘  └──────────┘   │
│                                 │
│  ┌──────────┐  ┌──────────┐   │
│  │ ☀️ 太阳能板│  │ 🏭 工作台  │   │
│  │  T2      │  │  T2      │   │
│  │ 🔒 Lv 10  │  │ 已解锁    │   │
│  └──────────┘  └──────────┘   │
└─────────────────────────────────┘
```

**建筑详情**:
```
┌─────────────────────────────────┐
│  ← 篝火                         │
├─────────────────────────────────┤
│        [等距视图图片]             │
│                                 │
│  名称: 篝火                      │
│  等级: Tier 1                    │
│  类型: 生存建筑                   │
│                                 │
│  描述:                           │
│  提供照明和温暖,是生存的基础设施。  │
│                                 │
│  建造需求:                       │
│  🪨 石头 x20          ✓ 足够    │
│  🪵 木材 x30          ✓ 足够    │
│                                 │
│  建造时间: 30分钟                 │
│                                 │
│         [开始建造] ✓             │
└─────────────────────────────────┘
```

#### 10.2.6 生存体征界面

```
┌─────────────────────────────────┐
│  ← 生存体征                      │
├─────────────────────────────────┤
│                                 │
│  ❤️ 核心生命                     │
│  ▓▓▓▓▓▓▓░░░ 69/100             │
│                                 │
│  🍖 饱食度                       │
│  ▓▓▓▓▓▓▓░░░ 68%                │
│  ⏱ 下次衰减: 42分钟后 (-5)       │
│                                 │
│  💧 水分                         │
│  ▓▓▓▓▓▓▓░░░ 70%                │
│  ⏱ 下次衰减: 22分钟后 (-10)      │
│                                 │
│  💡 提示:                        │
│  饱食度和水分保持在80%以上,        │
│  可获得探索奖励+20%加成!          │
│                                 │
│  ┌──────────────────────────┐  │
│  │ 可用物品:                 │  │
│  │ 🥫 罐头食品 x24  [使用]   │  │
│  │ 💧 饮用水 x18    [使用]   │  │
│  │ 💊 药品 x12      [使用]   │  │
│  └──────────────────────────┘  │
└─────────────────────────────────┘
```

### 10.3 交互设计

#### 10.3.1 手势操作

| 手势 | 功能 | 界面 |
|------|------|------|
| 点击 | 选择/确认 | 全局 |
| 长按 | 显示详情/快捷菜单 | 物品、建筑 |
| 双击 | 缩放 | 地图 |
| 双指缩放 | 放大/缩小 | 地图 |
| 单指拖动 | 移动视图 | 地图 |
| 上滑 | 展开详情 | 卡片 |
| 下滑 | 关闭/返回 | 模态窗口 |
| 左滑 | 删除/隐藏 | 列表项 |

#### 10.3.2 动画效果

**过渡动画**:
- 页面切换: 淡入淡出 (0.3秒)
- 卡片展开: 从底部上滑 (0.4秒)
- 物品获得: 飞入动画+闪光

**反馈动画**:
- 按钮点击: 缩放效果 (0.1秒)
- 成功操作: 绿色对勾+放大
- 失败操作: 红色叉号+震动

**持续动画**:
- 加载: 旋转圆圈
- 建造中: 进度条填充
- 生命值变化: 平滑过渡

#### 10.3.3 触觉反馈

| 事件 | 震动类型 |
|------|---------|
| 按钮点击 | 轻微震动 |
| 圈地闭合 | 中度震动 |
| 获得稀有物品 | 强震动 |
| 错误操作 | 快速双震 |
| 生命值低 | 持续轻震 |
| 重要通知 | 长震动 |

### 10.4 无障碍设计

**文字大小**:
- 支持动态字体 (Dynamic Type)
- 最小字号: 14pt

**颜色对比**:
- 遵循WCAG 2.1 AA标准
- 对比度≥4.5:1

**语音支持**:
- VoiceOver完整支持
- 所有图标有文字描述

**其他**:
- 色盲模式
- 减少动画选项
- 大字体模式

---

## 11. 新手引导

### 11.1 首次游戏流程 (FTUE)

#### 第一次启动 (5分钟教程)

**Step 1: 欢迎界面** (30秒)
```
[画面: 废墟上长出的绿苗]

旁白: "2051年,世界重生..."

文字: 欢迎来到地球新主
      在废墟之上,用脚步丈量你的王国

[开始游戏] 按钮
```

**Step 2: 登录引导** (1分钟)
```
提示: "首先,注册你的开拓者身份"

[选择登录方式]
- Apple ID (推荐)
- Google
- 邮箱注册

完成后跳转主界面
```

**Step 3: 圈地教学** (2分钟)
```
高亮"开始圈地"按钮

提示: "第一步:圈占你的第一块领地"
      "在现实中行走,游戏会记录你的轨迹"

[引导用户点击"开始圈地"]

地图界面显示:
"👣 开始行走吧!"
"走一个圆圈回到起点,这块地就是你的了"

[用户完成圈地]

🎉 "恭喜!你成功圈占了第一块领地!"
💰 奖励: 金币×100, 木材×50, 石头×50

解锁成就: 新手领主
```

**Step 4: 探索教学** (1分钟)
```
切换到"探索"标签

提示: "第二步:探索废墟获取资源"

[如果附近有POI]
高亮POI: "点击这里,搜刮物资"

[用户完成搜刮]

"太好了!你获得了资源"
"这些资源可以用来建造建筑"
```

**Step 5: 建造教学** (30秒)
```
切换到"资源"→"建造"

提示: "第三步:建造你的第一个建筑"

高亮"篝火": "点击建造篝火"

[引导建造]

"选择位置放置篝火"
[用户拖动放置]

"建造完成!🔥"
💰 奖励: 金币×50

解锁成就: 建造者
```

**Step 6: 完成引导**
```
"你已经学会了基础玩法!"

"接下来:"
✓ 探索更多POI获取资源
✓ 圈占更大的领地
✓ 建造更多建筑
✓ 与其他玩家交易

"祝你在新世界生存顺利!"

[进入游戏]
```

### 11.2 进阶引导 (通过任务引导)

#### 每日任务引导

**Day 2-3: 生存系统**
- 任务: 使用一次食物或水
- 奖励: 金币×100
- 说明: 介绍生存体征系统

**Day 4-5: 交易系统**
- 任务: 发布一次交易挂单
- 奖励: 金币×150
- 说明: 介绍交易功能

**Day 6-7: 社交系统**
- 任务: 发送10条消息
- 奖励: 金币×100
- 说明: 介绍公共频道

#### 等级解锁提示

当玩家达到解锁等级时:
```
🎉 恭喜升级到Lv 5!

解锁新功能:
✨ T2建筑
✨ 交易系统

[查看详情] [开始使用]
```

---

## 12. 游戏平衡性

### 12.1 难度曲线

#### 12.1.1 新手期 (Lv 1-5)

**特点**: 容易,鼓励探索
- 资源丰富
- 建造便宜
- 生存压力小
- 任务奖励高

#### 12.1.2 成长期 (Lv 6-15)

**特点**: 逐渐增加挑战
- 资源获取稳定
- 建造成本提升
- 生存压力中等
- 引入交易和社交

#### 12.1.3 中期 (Lv 16-30)

**特点**: 需要策略
- 需要优化资源分配
- 建造高级建筑
- 生存压力增加
- 排行榜竞争

#### 12.1.4 后期 (Lv 31+)

**特点**: 精通和优化
- 全功能解锁
- 高级玩法 (联盟、竞技)
- 追求极限优化

### 12.2 付费与免费平衡

#### 12.2.1 免费玩家体验

**可以做到的**:
- 完整游玩所有核心功能
- 圈占最多3块领地
- 每天探索5次
- 参与交易和社交
- 完成所有成就

**限制**:
- 探索次数有限
- 领地数量限制
- 建造速度较慢
- 背包容量较小

**预计游戏时长**: 每天20-30分钟可完成所有任务

#### 12.2.2 付费玩家优势

**月卡 ($9.99/月)**:
- 无限探索次数
- 最多10块领地
- 背包容量+50
- 建造时间-20%
- 探索范围+50%

**通行证 ($19.99/月)**:
- 月卡所有特权
- 无限领地数量
- 独占建筑
- 稀有资源产出+20%
- 专属称号和特效

**付费不能直接购买的**:
- 不能直接买资源 (只能买资源包,数量有限)
- 不能直接买等级
- 不能直接买排名

**原则**: Pay to Progress, Not Pay to Win
(付费加快进度,但不能直接获胜)

### 12.3 反作弊机制

#### 12.3.1 GPS作弊检测

**检测指标**:
- 移动速度异常 (>15 km/h)
- GPS信号跳跃
- 轨迹不连续
- 虚拟定位软件特征

**惩罚措施**:
1. 警告: 首次违规
2. 临时封禁: 24小时
3. 永久封禁: 多次违规

#### 12.3.2 交易刷资源检测

**检测指标**:
- 同一对玩家高频交易
- 新号大额交易
- 小号集群交易

**应对**:
- 交易冷却时间
- 新号交易限制
- 人工审核

#### 12.3.3 外挂检测

**技术手段**:
- 客户端完整性检查
- 异常数据上报
- 服务器端验证

---

## 13. 技术实现要点

### 13.1 核心技术栈

**前端** (iOS):
- Swift 5.9+
- SwiftUI (UI框架)
- MapKit (地图)
- CoreLocation (GPS)
- SwiftData (本地存储)
- StoreKit 2 (支付)
- AVFoundation (音频)

**后端** (BaaS):
- Supabase
  - PostgreSQL + PostGIS (数据库)
  - Supabase Auth (认证)
  - Supabase Realtime (实时通讯)
  - Supabase Storage (文件存储)

### 13.2 关键技术实现

#### 13.2.1 GPS轨迹记录

```swift
// 伪代码
class LocationManager {
    var pathPoints: [CLLocationCoordinate2D] = []

    func startTracking() {
        locationManager.startUpdatingLocation()
    }

    func locationUpdate(location: CLLocation) {
        // 过滤精度低的点
        guard location.horizontalAccuracy < 10 else { return }

        // 过滤速度过快的点 (防作弊)
        if let lastPoint = pathPoints.last {
            let speed = calculateSpeed(from: lastPoint, to: location)
            guard speed < 15 else { return } // 15 km/h限制
        }

        pathPoints.append(location.coordinate)

        // 检查是否闭合
        if isClosedLoop() {
            showClaimDialog()
        }
    }
}
```

#### 13.2.2 地理查询优化

```sql
-- PostGIS查询附近领地
CREATE INDEX idx_territories_geom ON territories USING GIST(geometry);

-- 查询与新领地重叠的现有领地
SELECT id FROM territories
WHERE ST_Intersects(geometry, ST_GeomFromText(:new_territory_wkt))
LIMIT 1;

-- 查询附近的POI
SELECT * FROM poi
WHERE ST_DWithin(
    location::geography,
    ST_SetSRID(ST_MakePoint(:longitude, :latitude), 4326)::geography,
    50 -- 50米范围
)
AND last_looted_at < NOW() - INTERVAL '24 hours';
```

#### 13.2.3 实时消息推送

```swift
// Supabase Realtime订阅
func subscribeToPublicChannel() {
    let channel = supabase.channel("public_messages")

    channel
        .on("INSERT", filter: "range=eq.\(currentRange)") { message in
            self.displayMessage(message)
        }
        .subscribe()
}
```

### 13.3 性能优化

#### 13.3.1 地图性能

- 只渲染可见区域的领地和POI
- 使用LOD (Level of Detail),远处简化显示
- 图标复用,避免重复创建
- 限制同屏渲染数量 (最多100个对象)

#### 13.3.2 数据同步

- 本地优先 (Local-first) 架构
- 后台增量同步
- 冲突解决策略 (Last Write Wins)
- 离线队列,网络恢复后重试

#### 13.3.3 资源加载

- 图片懒加载
- 预加载附近区域的数据
- CDN加速静态资源
- 图片压缩 (WebP格式)

---

## 14. 运营与活动设计

### 14.1 日常运营

**每日刷新**:
- 每日任务刷新 (00:00 UTC)
- POI冷却重置
- 生存体征衰减继续

**每周刷新**:
- 每周任务刷新 (周一00:00)
- 排行榜结算
- 限时商店更新

### 14.2 活动设计

#### 14.2.1 限时探索活动

**"黄金周末"** (每月第一个周末):
- 所有POI探索奖励×2
- 稀有物品掉落率+50%
- 专属活动POI出现

#### 14.2.2 建造竞赛

**"建设狂潮"** (每季度):
- 统计玩家建造的建筑总数
- 前100名获得稀有奖励
- 专属称号和头像框

#### 14.2.3 节日活动

**春节、圣诞节等**:
- 特殊主题POI
- 节日限定建筑
- 主题UI和音乐
- 专属任务和奖励

### 14.3 赛季系统 (未来)

**赛季周期**: 3个月

**赛季内容**:
- 新的主题和故事线
- 新的建筑和物品
- 赛季排行榜
- 赛季通行证 (Battle Pass)

**赛季奖励**:
- 赛季专属称号
- 限定建筑蓝图
- 大量资源和金币

---

## 15. 未来扩展功能

### 15.1 短期规划 (3-6个月)

- **联盟系统**: 玩家组建联盟,共同建设大型项目
- **PvP竞技**: 领地争夺战
- **宠物系统**: 可培养的宠物助手
- **载具系统**: 提升移动速度

### 15.2 中期规划 (6-12个月)

- **大型副本**: 特殊地点的团队挑战
- **跨服竞技**: 全球玩家排名
- **自定义建筑**: 玩家自己设计建筑外观
- **AR探索**: 使用ARKit增强现实探索

### 15.3 长期愿景

- **玩家驱动经济**: 完全由玩家决定物品价值
- **UGC内容**: 玩家创建任务和故事
- **跨平台**: Android版本
- **元宇宙整合**: 与其他游戏/平台互通

---

## 附录

### A. 参考游戏分析

**宝可梦GO**:
- 学习: LBS探索机制、POI利用、Walk to Earn
- 差异: 我们更强调建造和生存

**Minecraft**:
- 学习: 建造系统、资源管理、合成系统
- 差异: 我们基于真实地理而非虚拟世界

**饥荒 (Don't Starve)**:
- 学习: 生存体征系统、时间衰减机制
- 差异: 我们是LBS游戏而非纯生存

**Ingress**:
- 学习: 基于位置的团队竞技
- 差异: 我们更强调个人建设和生存

### B. 用户研究建议

**测试重点**:
1. 圈地操作是否直观?
2. 探索频率是否合适?
3. 生存压力是否过大?
4. 付费点是否合理?

**数据收集**:
- 留存率 (D1/D7/D30)
- 平均游戏时长
- 付费转化率
- 功能使用率

### C. 术语表

- **LBS**: Location Based Service (基于位置的服务)
- **POI**: Point of Interest (兴趣点)
- **FTUE**: First Time User Experience (首次用户体验)
- **UGC**: User Generated Content (用户生成内容)
- **ARPU**: Average Revenue Per User (平均每用户收入)
- **LTV**: Lifetime Value (用户生命周期价值)

---

**文档结束**

最后更新: 2025-12-30
版本: 1.0
